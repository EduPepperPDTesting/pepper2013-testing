<head>
  <title>Training Location</title>
  <script type="text/javascript" src="/static/js/vendor/jquery.min.js" charset="utf-8"></script>
  <script src="/static/js/leaflet/leaflet.js"></script>
  <link rel="stylesheet" href="/static/js/leaflet/leaflet.css" type = "text/css" media = "screen"/>
  <style type="text/css" media="screen">
   body{margin:0};
  </style>
</head>
<body>
  <div id="mapid" style="width:100%;height:100%;"></div>
  <script>
    var geo_location='${training.geo_location}';
    var state='${request.user.profile.district.state.name} United States';
    var mymap = L.map('mapid');
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
	  maxZoom: 18,
	  attribution: '',
	  id: 'mapbox.streets'
    }).addTo(mymap);

    var place = geo_location || state;

    $.getJSON('https://nominatim.openstreetmap.org/search?format=json&polygon=1&addressdetails=1', {q: place}, function(r){
      if(r.length){
        var data = r[0];
        $.each(r, function(i, d){
          if(d.display_name == place){
            data = d;
          }
        });
        mymap.setView([data.lat, data.lon], 10);
        L.marker([data.lat, data.lon]).addTo(mymap);
      }else{
        mymap.setView([38.68551, -99.22852], 3);
        L.marker([38.68551, -99.22852]).addTo(mymap); 
      }
    });
  
    /* 
	   var mymap = L.map('mapid').setView([ 40.07, 124.23], 10);
	   L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
	   maxZoom: 18,
	   attribution: '',
	   id: 'mapbox.streets'
	   }).addTo(mymap);
	   L.marker([40.07, 124.23]).addTo(mymap)
	   .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();
	   L.circle([51.508, -0.11], 500, {
	   color: 'red',
	   fillColor: '#f03',
	   fillOpacity: 0.5
	   }).addTo(mymap).bindPopup("I am a circle.");
	   L.polygon([
	   [51.509, -0.08],
	   [51.503, -0.06],
	   [51.51, -0.047]
	   ]).addTo(mymap).bindPopup("I am a polygon."); 
	   var popup = L.popup();
	   function onMapClick(e) {
	   popup
	   .setLatLng(e.latlng)
	   .setContent("You clicked the map at " + e.latlng.toString())
	   .openOn(mymap);
	   }
	   mymap.on('click', onMapClick);
       mymap.on('scale', function(){
       }); */
  </script>
</body>
