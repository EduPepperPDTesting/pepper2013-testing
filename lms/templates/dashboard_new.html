<%! from django.utils.translation import ugettext as _ %>
<%!
    from django.core.urlresolvers import reverse
    from courseware.courses import course_image_url, get_course_about_section
    from courseware.access import has_access
    from certificates.models import CertificateStatuses
    from xmodule.modulestore import MONGO_MODULESTORE_TYPE
    from xmodule.modulestore.django import modulestore
    from django.utils import timezone
    from student.models import School,Cohort,District,SubjectArea,GradeLevel,YearsInEducation
    from baseinfo.models import Enum
    import datetime
    
    from student.models import State,District,School,User,UserProfile
    from organization.models import OrganizationMetadata, OrganizationDistricts, OrganizationDashboard, OrganizationMenu, OrganizationMenuitem, OrganizationAttributes  
%>
<!--@begin:Hide Dashboard button in this page-->
<!--@date:2013-11-02-->
<style type="text/css" media="screen">
#image_uploading{display:none;}
 ._del_line{
    text-decoration: none !important;
 }
 .course-register{
    display:block;
    width:195px;
    margin-top:10px;
    text-align:center;
    float:left;
    font-size:13px !important;
 }
/*--from .css-----------------------------------------------------------------*/

.ds-post-title{
    padding:5px 5px 5px 10px;
    border:0px solid #f00;
}
/*85px fixed*/
.ds-post-title-photo{
    width: 85px;
    position: relative;
    border:0px solid;
}
/*520px modified*/
.ds-post-title-text{
    padding:5px 5px 5px 5px;
    width: 520px;

    border:0px solid;
}
/*20px fixed*/
.ds-post-title-delete{
    text-align: center;
    width: 20px;
    border:0px solid;
}

.ds-post-title-name{
    color:#5c9cd5;
    font-size:14px;
    font-weight:bold;
}
.ds-post-title-from{
    color: #8d8d8d;
    font-size:14px;
}
.ds-post-title-position{
    color:#ff6600;
    font-size:14px;
    font-weight:bold;
}
.ds-post-title-time{
    color: #8d8d8d;
    font-size:13px;
    font-style: italic;
}
.ds-post-content{
    /*width:100%;*/
    color: #404040;
    font-weight: bold;
    padding:5px 5px 5px 5px;
    font-size: 15px;
    line-height: 22px;
    border:0px solid; 
}
.ds-post-footer{
    border-bottom: 0px solid #3891e0;
}

.ds-post-end_line{
    width: 100%;
    border-bottom: 2px solid #3891e0;
    margin-bottom: 15px;
}

a{
    text-decoration:none !important;
}
/*--left My Courses--------------------------------------------*/
.con-my-courses-outer{
    float:left;
    width:250px;
    height:50px;
}
.con-my-courses{
    width:250px;
    height:795px;
    background-color: #fff;
}
.my-title-green{
    width:204px;
    padding:10px;
    background-color:#89C153;
    text-align: center;
    font-size:16px;
    color:#fff;
    text-decoration:none !important;
    cursor:pointer;
    margin-left: 13px;
    margin-top: 10px;
}
.my-courses-cards{
    float: left;
    width: 250px;
    border:0px solid;
}
.course-incomplated{
    width:194px;
    padding:10px;
    font-size: 14px;
    margin-left: 13px;
    margin-top: 10px;
    background-color: #fff;
}
.course-incomplated a{
    font-size: 14px !important;
    color: #000;
}
.ds-view-all-courses{
    width:230px;
    text-align:right;
    float: left;
    /*margin-top:-10px;*/
    padding-right:20px;
    border: 0px solid;

}
.ds-view-all-courses a{
    font-size: 16px;
    color: #0070d5;
    text-decoration: none !important;
    cursor: pointer;
}
.ds-view-allowed-courses{
    width:230px;
    text-align:right;
    float: left;
    padding-right:20px;
}
.ds-view-allowed-courses a{
    font-size: 16px;
    color: #0070d5;
    text-decoration: none !important;
    cursor: pointer;
}
/*--right My Communities---------------------------------------------*/
.con-my-communities-outer{
    float:left;
    width:250px;
    height:820px;
    margin-left: 27px;
}
.con-my-communities{
    width:250px;
    height:790px;
    background-color: #fff;
    position:fixed;
    padding-bottom: 5px;
}
.my-profile-logo{
    width:230px;
    height:170px;
    margin-left: 10px;
    margin-top: 10px;
    text-align: center;
}
.my-title-blue{
    width:204px;
    padding:10px;
    background-color:#2CBAEC;
    text-align: center;
    font-size:16px;
    color:#fff;
    text-decoration:none !important;
    cursor:pointer;
    margin-left: 13px;
    margin-top: 10px;
}
.community-trending-topics{
    margin-bottom: 25px;
}
.my-community{
    width:210px;
    margin-left:18px;
    padding:8px 0px 10px 0px;
    border-bottom:1px solid #ccc;
}
.my-community-noline{
    width:210px;
    margin-left:18px;
    padding:8px 0px 10px 0px;
}
.trending-topic{
    margin-top: 10px;
}
.trending-topic .tt-title{
    padding:1px 0px 1px 0px;
    font-size:16px;
    font-weight:bold;
    /*color:#92c900;*/

    width: 100%;
    height: 18px;

    text-overflow:ellipsis;
    overflow:hidden;
    white-space:nowrap;

    border:0px solid;
}
.trending-topic .tt-post{
    padding:1px 0px 1px 0px;
    width: 100%;
    height: 18px;
    font-weight:bold;
    color:#29b7ec;
    font-size:14px;

    text-overflow:ellipsis;
    overflow:hidden;
    white-space:nowrap;
}
.trending-topic .tt-post a{
    font-weight:bold;
    color:#29b7ec;
    font-size:14px;
    text-decoration:none !important;
}
.trending-topic .tt-time{
    padding:1px 0px 1px 0px;
    font-size:14px;
    height: 18px;
    font-weight: bold;
    margin-top: 8px;
}
.trending-topic .tt-btn-reply{
    width:80px;
    background-color:#F58221;
    border-radius: 5px;
    text-align: center;
    padding: 4px 0px 4px 0px;
}
.trending-topic .tt-btn-addme{
    width:80px;
    background-color:#89C153;
    border-radius: 5px;
    text-align: center;
    padding: 4px 0px 4px 0px;
}
.my-communities-cards{
    width: 224px;
    margin-left: 13px;
    background-color: #4a4c4d;
    padding: 18px 0px 1px 0px;
}
.ma-community-simple{
    width:194px;
    background: #f5f5f5;
    border-radius: 4px;
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    text-align: center;
    padding: 8px 3px 8px 3px;
    font-size: 14px;
    color: #000;
    margin-left: 12px;
    margin-bottom:18px; 
    background-image: linear-gradient(rgba(255,255,255,.1), rgba(255,255,255,.05) 49%, rgba(0,0,0,.05) 51%, rgba(0,0,0,.1));
    border:1px solid #ccc;

    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}
.ma-community-simple:hover{
    background-image: linear-gradient(rgba(255,255,255,.1), rgba(255,255,255,.05) 49%, rgba(255,255,255,.05) 51%, rgba(255,255,255,.1));
}
.ds-view-all-communities{
    width:224px;
    text-align:right;
    margin-top: 10px;
    margin-left: 13px;
}
.ds-view-all-communities a{
    font-size: 16px;
    color: #0070d5;
    text-decoration: none !important;
    cursor: pointer;
}
/*--middle Main Content All-----------------------------------*/
.con-maincontent-all{
    width:680px;
    margin-left:27px;
    float:left;
    position: relative;
    margin-bottom:0px;
    background-color:#e4e4e4;
    border-top:3px solid #fff;
    border-left:3px solid #fff;
    border-right:3px solid #fff;
}
.con-feed-activity{
    width:680px;
    height:50px;
    float:left;
    background-color:#e4e4e4;
    border:0px solid #000;
}
.my-feed-btn{
    width:130px;
    height:30px;
    padding-top:15px;

    margin-left: 7px;
    margin-top:3px;
    float:left;
    text-align:center;
    font-weight:bold;
    color:#0b0bdd;
    cursor: pointer;
    font-size:18px;
}
.my-activity-btn{
    width:130px;
    height:30px;
    padding-top:15px;

    margin-top:3px;
    float:left;
    text-align:center;
    font-weight:bold;
    color:#0b0bdd;
    cursor: pointer;
    font-size:18px;
}
.my-report-card-btn{
    width:180px;
    height:30px;
    padding-top:15px;

    margin-top:3px;
    float:left;
    text-align:center;
    font-weight:bold;
    color:#0b0bdd;
    cursor: pointer;
    font-size:18px;
}
.mytab-active{
    background-color:#fff;
    border-left:2px solid #cbcbcb;
    border-top:2px solid #cbcbcb;
    border-right:2px solid #cbcbcb;
    border-radius:5px 5px 0px 0px; 
    cursor: auto !important;
}
.my-feed{
    width:674px;
    float:left;
    border-top:3px solid #d9d9d9;
    border-left:3px solid #d9d9d9;
    border-right:3px solid #d9d9d9;
    border-radius: 6px 6px 0px 0px; 
    display: none;

    min-height:727px;
    padding-bottom: 3px;
  
}
.my-activity{
    width:674px;
    overflow: hidden;
    float:left;
    border-top:3px solid #d9d9d9;
    border-left:3px solid #d9d9d9;
    border-right:3px solid #d9d9d9;
    border-radius: 6px 6px 0px 0px; 
    background-color: #fff;

    min-height:727px;
    padding-bottom: 3px;
}
.my-report-card{
    width:674px;
    overflow: hidden;
    float:left;
    border-top:3px solid #d9d9d9;
    border-left:3px solid #d9d9d9;
    border-right:3px solid #d9d9d9;
    border-radius: 6px 6px 0px 0px; 
    background-color: #fff;

    min-height:727px;
    padding-bottom: 3px;

    display: none;
}
/*----middle Main Content:My Activity----*/
.con-ma-filter{
    width:659px;
    height:30px;
    text-align: right;
    padding-top:8px;
    padding-right:15px;
    padding-bottom:3px;

    border:0px solid;
}
.con-ma-filter select{
    margin-right: 10px;
} 
.ma-btn-filter{
    padding:10px;background-color: #556370;
    padding-bottom: 2px !important;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 2px !important;color:#fff;
    cursor: pointer;
}

.con-ma-rows{
    /*width: 692px;
    height:674px;
    float: left;*/
}
.my-activity-row{
    float: left;
    width:674px;
    min-height:72px;
    border:0px solid #f00;
    margin-bottom: 3px;
}
.ma-row-ico{
    width:112px;
    height:69px;
    margin-left:10px;
    float:left;
    text-align:right;
}
.ma-row-cotent{
    width:540px;
    min-height:69px;
    margin-left:5px;
    float:left;
    border-radius:5px;
    font-size: 14px;
    border:1px solid #ccc;
}
.ma-row-cotent-time{
    margin-top: 9px;
    padding: 5px;
    font-style: italic;
    border:0px solid;
}
.ma-row-cotent-info{
    padding: 5px;
    border:0px solid;
    margin-bottom: 9px;
}
.ma-row-cotent-info a{
    color: #000;
    cursor: pointer;
    text-decoration: none !important;
    /*
    font-weight: bold;
    font-style: italic;
    */
}
/*--my activity community ico--*/
.ma-community-ico{
    width: 110px;
    height: 69px;
    border: 1px solid #ccc;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
}
.ma-community-image-link-style {
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    display: block;
    float: left;
    width:110px;
    height:69px;
    background-size: auto 41px;
    background-color: white;
    background-position: 50% 0;
    background-repeat: no-repeat;
    text-align: center;
}
.ma-community-image-bottom-style {
    border-radius: 0 0 3px 3px;
    -moz-border-radius: 0 0 3px 3px;
    -webkit-border-radius: 0 0 3px 3px;
    display: block;
}
.ma-community-card-link {
    display: block;
    width: 100px;
    height: 18px;
    vertical-align: middle;
    background: rgba(18,111,154,0.95);
    text-decoration: none !important;
    color: #FFFFFF;
    font-size: 12px;
    padding: 5px;

    text-overflow:ellipsis;
    white-space:nowrap;
    overflow:hidden;
}

/*--my activity course ico--*/
.ma-course-course-card{
    background-color: #FFFFFF;
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    float: left;
    width: 110px;
    height:69px;
    position: relative;
    cursor: auto!important;
    text-align: center;
    border: 1px solid #ccc;
}
.ma-course-card-top{
    position: relative;
}
.ma-course-image-style{
    border-radius: 3px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    display: block;
    width:110px;
    height:69px;
    cursor: pointer;
}
.ma-course-course-title {
    display: table;
    position: absolute;
    bottom: 0;
}
.ma-course-card-link{
    width: 100px;
    height: 18px;
    padding: 5px;
    background: rgba(18,111,154,0.95);
    text-decoration: none!important;
    border-radius: 0px 0px 3px 3px;
    -moz-border-radius: 0px 0px 3px 3px;
    -webkit-border-radius: 0px 0px 3px 3px;
    color:#fff;
    font-size: 12px;
    cursor: pointer;

    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}


</style>
<!--@end-->
<%inherit file="main.html" />
<%
    OrganizationOK = False
    if request.user.is_authenticated():            
        try:
            state_id = request.user.profile.district.state.id
            district_id = request.user.profile.district.id
            school_id = request.user.profile.school.id
        except:
            state_id = -1
            district_id = -1
            school_id = -1
            
        organization_obj = OrganizationMetadata()
        if (school_id != -1):
            for tmp1 in OrganizationDistricts.objects.filter(OrganizationEnity=school_id, EntityType="School"):
                organization_obj = tmp1.organization
                OrganizationOK = True
                break;

        if (not(OrganizationOK) and district_id != -1):
            for tmp1 in OrganizationDistricts.objects.filter(OrganizationEnity=district_id, EntityType="District"):
                organization_obj = tmp1.organization
                OrganizationOK = True
                break;
        
        if (not(OrganizationOK) and state_id != -1):
            for tmp1 in OrganizationDistricts.objects.filter(OrganizationEnity=state_id, EntityType="State"):
                OrganizationOK = True
                organization_obj = tmp1.organization
                break;
                
        data = {}
        data['profile_logo'] = ''
        if OrganizationOK:
            data["org_id"] = organization_obj.id;
            for tmp1 in OrganizationMenu.objects.filter(organization=organization_obj):
                data[tmp1.itemType] = tmp1.itemValue
            for tmp1 in OrganizationAttributes.objects.filter(organization=data["org_id"]):
                data['profile_logo'] = tmp1.LogoProfile
                break;
            if data['profile_logo']:
                data['profile_logo'] = "/static/uploads/organization/" + organization_obj.id + "/" + data['profile_logo']

%>
<%namespace name='static' file='static_content.html'/>
<%block name="title"><title>${_("Dashboard - {username}".format(username=curr_user.username))}</title></%block>

<!--@date:20161222-->
<script type="text/javascript" src="/static/js/admin_ui_controls.js"></script>
<link rel="stylesheet" type="text/css" href="/static/css/dashboard-new-temp.css" />
<!--@end-->
<script src="/static/js/datetime/moment.js"></script>

<section class="content-wrapper1" style="margin-top:0px;background-color:#e7e7e8;">
    <section class="dashboard" style="margin:0 auto;width:1240px;padding-top:69px;">
        <!--width 220 + 40 + 660 + 40 + 220 = 1180-->
        <!--Courses Dashboard-->
        <div class="con-my-courses-outer">
        <div class="con-my-courses" style="position:fixed;">
            <a href="/courses">
                <div class="my-title-green">My Courses</div>
            </a>
            <div class="my-courses-cards">
                %for course in courses_incomplated:
                    <%
                        course_target = reverse('courseware', args=[course.id])
                    %>
                    <div class="course-incomplated">
                         %if curr_user == request.user:
                            %if not course.close_course:      
                                <a href="${course_target}"><b>${get_course_about_section(course, 'title')}</b>|${course.display_number_with_default | h}
                            %else:
                                <a href="${reverse('cabout', args=[course.id])}"><b>${get_course_about_section(course, 'title')}</b>|${course.display_number_with_default | h}
                            %endif
                            </a>
                        %endif
                    </div>
                %endfor
            </div>
            <div class="ds-view-all-courses">
                <a href="/my_courses">View All</a>
            </div>

            %if len(allowedcourses) > 0:
                <!--allowedcourse-->
                <a href="/more_courses_available">
                    <div class="my-title-green" style="float:left;margin-top:30px;border:0px solid;">My New Courses</div>
                </a>
                <div class="my-courses-cards">
                    %for course in allowedcourses:
                        <div class="course-incomplated">
                            <a href="${reverse('cabout', args=[course.id])}" title="${get_course_about_section(course, 'title')}">
                                <b>${get_course_about_section(course, 'title')}</b>|${course.display_number_with_default | h}
                            </a>
                        </div>
                    %endfor
                </div>
                <div class="ds-view-allowed-courses">
                    <a href="/more_courses_available">View All</a>
                </div>
            %endif
        </div>
        </div>

        <div class="con-maincontent-all clearfix">
            <div class="con-feed-activity">
            % if OrganizationOK and data["My Feed Show"] == "1":
                <div class="my-feed-btn mytab-active">My Feed</div>                
            % endif
            % if OrganizationOK and data["My Activities Show"] == "1":
                <div class="my-activity-btn" style="">My Activity</div>             
            % endif
            % if not(OrganizationOK):
                <div class="my-feed-btn mytab-active">My Feed</div>
                <div class="my-activity-btn" style="">My Activity</div>
            % endif
                <div class="my-report-card-btn" style="">My Report Card</div>
            </div>
            <div id="my_feed" class="my-feed ">
                <!--Post Dashboard-->
                <!--w:660,min-h:800-->
                <%include file="dashboard_my_feed.html" />
            </div>
            <!--w:674 = 680-3*2-->
            <div id="my_activity" class="my-activity">
                <div class="con-ma-filter">
                    <select id = "ma_select_group" style="margin-right:30px;">
                        <option value = ''>Group</option>
                        <option value = 'Community'>Community</option>
                        <option value = 'Courses'>Courses</option>
                        <option value = 'Messages'>Messages</option>
                        <option value = 'MyChunks'>My Chunks</option>
                        <option value = 'MyFeed'>My Feed</option>
                        <option value = 'PDPlanner'>PD Planner</option>
                        <option value = 'Reports'>Reports</option>
                    </select>
                    <select id = "ma_select_year">
                        <option value = ''>Year</option>
                        %if my_activity_year_start:
                            %for y in range(my_activity_year_start, my_activity_year_end + 1):
                                <option value='${y}'>${y}</option>
                            %endfor
                        %endif
                    </select>
                    <select id = "ma_select_month">
                        <option value = ''>Month</option>
                        <option value = '1'>January</option>
                        <option value = '2'>February</option>
                        <option value = '3'>March</option>
                        <option value = '4'>April</option>
                        <option value = '5'>May</option>
                        <option value = '6'>June</option>
                        <option value = '7'>July</option>
                        <option value = '8'>August</option>
                        <option value = '9'>September</option>
                        <option value = '10'>October</option>
                        <option value = '11'>November</option>
                        <option value = '12'>December</option>
                    </select>
                    <span class="ma-btn-filter">Filter</span>
                </div>
                
                <div class="con-ma-rows">
                </div>
                <div class="info_div" style="width:670px;height:81px;font-size:15px;float:left;display:auto;">
                    <center><img id="posts_loading_image1" src="/static/images/posts-loading.gif"></img></center>
                </div>
            </div>

            <div id="my_report_card" class="my-report-card">
                <!--Post Dashboard-->
                <!--w:660,min-h:800-->
                my_report_car
            </div>
        </div>
        
        <!--Community Dashboard-->
        <div class="con-my-communities-outer">
            <div class="con-my-communities">
                <!--width:220px-->
                <div class="community-trending-topics">
                    <div class="my-profile-logo">
                    %if data['profile_logo']:
                        <img src="${data['profile_logo']}" style="max-width:230px;max-height:170px;"/>
                    %endif
                    </div>
                    <a href="/communities">
                        <div class="my-title-blue">My Trending Topics</div>
                    </a>
                    <div class="trending-topic" style="border:0px solid;">
                        %for k,c in enumerate(community_trending_topics):
                            %if k + 1 == len(community_trending_topics):
                                <div class="my-community-noline">
                            %else:
                                <div class="my-community">
                            %endif
                                <div class="tt-title">${c['cname']}</div>
                                <div class="tt-post"><a href=${c['btnurl']}>${c['content']}</a></div>
                                <div class="tt-time">Last Post: ${'{dt:%b} {dt.day}, {dt.year}'.format(dt=c['date_reply'])}</div>
                                %if c['btntext'] == "Reply":
                                    <div class="tt-btn-reply">
                                %else:
                                    <div class="tt-btn-addme">
                                %endif
                                    <a href=${c['btnurl']} style="color:#fff;font-size:13px;">${c['btntext']}</a>
                                </div>
                            </div>
                        %endfor
                    </div>
                </div>
                <div class="my-learning-communities">
                    <a href="/communities">
                        <div class="my-title-blue">My Communities</div>
                    </a>
                    <div class="my-communities-cards">
                        <%
                            community_count = len(communities)
                        %>
                        %for community in communities:
                            <a href="${reverse('community_view', args=[community['id']])}" style="text-decoration: none;">
                                <div class="ma-community-simple">
                                    ${community['name']}
                                </div>
                            </a>
                        %endfor
                    </div>
                    <div class="ds-view-all-communities"><a href="/communities">View All</a></div>
                </div>
            </div>
        </div>
        <div style="clear:both;"></div>
    </section>
</section>

<script>
$(document).ready(function(){
    //20170221=================================================================================================
    $(window).on('unload', function() {
        $(window).scrollTop(0);
    });
    % if OrganizationOK and data["Is My Feed Default"] == "1":
        var now_show = 1; //1:my feed;2:my activity
    % else:
        var now_show = 2; //1:my feed;2:my activity
    % endif
    
    var data_all = 0;
    var html_loading = '<center><img id="posts_loading_image1" src="/static/images/posts-loading.gif"></img></center>';
    var html_end = '<div style="width:100%;text-align:center;padding-top:25px;font-size:18px;font-weight:bold;">No Search Results Found</div>';
    var data_loading = 0;


    //variable for init
    var get_rows_init = 0;
    var skip_rows_init = 0;
    var get_rows_scroll = 0;
    var skip_rows_scroll = 0
    var data_count = 0;
    my_activitis_init();
    
    if(now_show == 1){
        $(".my-activity-btn").removeClass("mytab-active");
        $(".my-activity").hide();
        $(".my-report-card-btn").removeClass("mytab-active");
        $(".my-report-card").hide();

        $(".my-feed-btn").addClass("mytab-active");
        $(".my-feed").show();   
    }
    else if(now_show == 2){
        $(".my-feed-btn").removeClass("mytab-active");
        $(".my-feed").hide();
        $(".my-report-card-btn").removeClass("mytab-active");
        $(".my-report-card").hide();

        $(".my-activity-btn").addClass("mytab-active");
        $(".my-activity").show(); 
    }
    else{
        $(".my-feed-btn").removeClass("mytab-active");
        $(".my-feed").hide();
        $(".my-activity-btn").removeClass("mytab-active");
        $(".my-activity").hide();

        $(".my-report-card-btn").addClass("mytab-active");
        $(".my-report-card").show(); 
    }

    $(".my-feed-btn").click(function(){
        if(now_show != 1){
            $(".my-activity").hide();
            $(".my-activity-btn").removeClass("mytab-active");
            $(".my-report-card").hide();
            $(".my-report-card-btn").removeClass("mytab-active");
    
            $(".my-feed").show();
            $(".my-feed-btn").addClass("mytab-active");
            now_show = 1;
        }
    });
    $(".my-activity-btn").click(function(){
        if(now_show != 2){
            $(".my-feed").hide();
            $(".my-feed-btn").removeClass("mytab-active");
            $(".my-report-card").hide();
            $(".my-report-card-btn").removeClass("mytab-active");

            $(".my-activity").show();
            $(".my-activity-btn").addClass("mytab-active");
            now_show = 2;
        }
    });
    $(".my-report-card-btn").click(function(){
        if(now_show != 3){
            $(".my-feed").hide();
            $(".my-feed-btn").removeClass("mytab-active");
            $(".my-activity").hide();
            $(".my-activity-btn").removeClass("mytab-active");

            $(".my-report-card").show();
            $(".my-report-card-btn").addClass("mytab-active");
            now_show = 3;
        }
    });
    get_my_activites(get_rows_init,skip_rows_init); //ma start

    //my activity----------------------------------------------------------------
    function my_activitis_init(){
        get_rows_init = 10;
        skip_rows_init = 0;
        get_rows_scroll = 3;
        skip_rows_scroll = get_rows_init
        data_count = 0;
        $(".info_div").html(html_loading);
        $(".info_div").hide();
        $(window).scrollTop(0);
    }

    function get_my_activites(get_rows,skip_rows){
        data_loading = 1;
        $(".info_div").show();
        filter_year = $("#ma_select_year").val();
        filter_month = $("#ma_select_month").val();
        filter_group = $("#ma_select_group").val();

        $.post("${reverse('get_my_activities')}", 
            {'user_id':'${request.user.id}',
             'filter_year':filter_year,
             'filter_month':filter_month,
             'filter_group':filter_group,
             'get_rows':get_rows,
             'skip_rows':skip_rows},
            function(data_obj){
                data_all = data_obj.data_count;
                my_activitis_create(data_obj);
                data_loading = 0;
                if(data_all != 0){
                    $(".info_div").hide();
                }
                else{
                    $(".info_div").html(html_end);
                }
        });
    }

    function my_activitis_create(data_obj){
        for(var i=0;i<data_obj.data.length;i++){
            data_count ++;
            my_activity_create(data_obj.data[i]);
        }
        //$(".info_div").html(html_end);
    }
    function my_activity_create(data){
        var displayDate = time_to_local(data.time);
        my_activity_create_ico(data);
        
        element_html = '<div class="my-activity-row">';
        element_html += '<div class="ma-row-ico">';
        element_html += data.html_ico;
        element_html += '</div>';
        element_html += '<div class="ma-row-cotent">';
        element_html += '<div class="ma-row-cotent-time">'+displayDate+'</div>';
        element_html += '<div class="ma-row-cotent-info">';
        element_html += data.DisplayInfo;
        element_html += '</div>';
        element_html += '</div>';

        element = $(element_html);
        $('.con-ma-rows').append(element);
    }
    function my_activity_create_ico(data){
        //switch_ActivityType
        switch(data.g_type)
        {
            case 'Community':
                data.html_ico = '<a href="'+data.URL+'">'
                data.html_ico += '<div class="ma-community-ico">';
                data.html_ico += '<div class="ma-community-image-link-style" style="background-image:url('+data.logoUrl+')">';
                data.html_ico += '<div style="height:41px;"></div>';
                data.html_ico += '<span class="ma-community-card-link ma-community-image-bottom-style">'+data.logoName+'</span>';
                data.html_ico += '</div>';
                data.html_ico += '</div>';
                data.html_ico += '</a>';
                break;
            case 'Courses':
                data.html_ico = '<a href="'+data.URL+'">';
                data.html_ico += '<div class="ma-course-course-card">';
                data.html_ico += '<div>';
                data.html_ico += '<img typeof="foaf:Image" class="ma-course-image-style" src="'+data.logoUrl+'" alt="Cover Image">';
                data.html_ico += '</div>';
                data.html_ico += '<div class="ma-course-course-title">';
                data.html_ico += '<div class="ma-course-card-link">'+data.logoName+'</div>';
                data.html_ico += '</div>';
                data.html_ico += '</div>';
                data.html_ico += '</a>';
                break;
            default:
                data.html_ico = '<table border="0" width="110" height="69" cellpadding="0" cellspacing="0">';
                data.html_ico += '<tr>';
                data.html_ico += '<td align="center"><a href="'+data.URL+'"><img src="'+data.logoUrl+'"></img></a></td>';
                data.html_ico += '</tr>';
                data.html_ico += '</table>';
        }
    }

    function time_to_local(time){
        var local_time =  new Date();
        var local_utc_diff_m = -1 * local_time.getTimezoneOffset();
        var local_utc_diff_h = local_utc_diff_m / 60;
        displayDate = ""

        if(isToday(time)) {
            displayDate = "Today at " + moment(time).add(local_utc_diff_h,'hours').format('hh:mm A') 
        }
        else{
            displayDate = moment(time).add(local_utc_diff_h,'hours').format('MMM DD, YYYY')
        }
        return displayDate;
    }

    function isToday(str){
        //var d = new Date(str.replace(/-/g,"/"));
        var d = new Date(str);
        var todaysDate = new Date();
        if(d.setHours(0,0,0,0) == todaysDate.setHours(0,0,0,0)){
            return true;
        } 
        else {
            return false;
        }
    }
    //my activity event--------------------------------------------------------------------
    $(".ma-btn-filter").click(function(){
        if(!data_loading){
            my_activitis_init();

            $(".con-ma-rows").find("div").remove();
            get_my_activites(get_rows_init,skip_rows_init);
        }
    });

    $(window).bind("scroll", function(){
        var scrollTop = $(this).scrollTop();
　　    var windowHeight = $(this).height();
        var scrollHeight = $(document).height();
        var scrollTop_ceil = Math.ceil(scrollTop);

        console.log("scrollTop:",scrollTop);
        console.log("windowHeight:",windowHeight);
        console.log("scrollHeight:",scrollHeight);
        console.log("scrollTop_ceil:",scrollTop_ceil);

        if(scrollTop_ceil + windowHeight >= scrollHeight)
        {
            if(skip_rows_scroll >= data_all){
                console.log("111");
                //$(".info_div").hide();
                ////$(".info_div").html(html_end);
            }else{
                console.log("now_show:",now_show);
                //$(".info_div").show();
                ////$(".info_div").html(html_loading);
                if(now_show ==2 ){
                    console.log("333");
                    get_my_activites(get_rows_scroll,skip_rows_scroll)
                    skip_rows_scroll += get_rows_scroll; 
                } 
            }
        }
    });
});
</script>

