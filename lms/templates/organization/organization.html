<%! from django.utils.translation import ugettext as _ %>
<%!
    from django.core.urlresolvers import reverse
    from courseware.courses import course_image_url, get_course_about_section
    from courseware.access import has_access
    from certificates.models import CertificateStatuses
    from xmodule.modulestore.django import modulestore
    import json
    from student.models import State,District,School,User,UserProfile    
%>
<%inherit file="../main.html"/>

<script type="text/javascript" src="/static/js/admin_ui_controls.js"></script>
<script type="text/javascript" src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/tablesorter/js/jquery.tablesorter.js"></script>
<script type="text/javascript" src="/static/js/tablesorter/js/extras/jquery.tablesorter.pager.min.js"></script>
<script type="text/javascript" src="/static/js/tablesorter/js/widgets/widget-filter.min.js"></script>
<script type="text/javascript" src="/static/js/ajaxfileupload.js"></script>

<link rel="stylesheet" href="/static/css/admin_ui_controls.css" type="text/css" media="screen" />
<link rel="stylesheet" href="/static/js/tablesorter/css/theme.blue.min.css" media="screen"/>
<link rel="stylesheet" href="/static/js/tablesorter/css/jquery.tablesorter.pager.min.css" media="screen" />
<link rel="stylesheet" href="/static/css/permissions.css" type="text/css" media="screen" />

<style>
	input[type=button].small_btn{font-size:12px;height:2em;line-height:2em;padding:0 10px;}
	.organization_main{margin: 0 auto 30px auto; width: 1180px; padding: 10px;}
	.organization_main1{margin: 0 auto 0 auto; width: 1180px; border: 1px solid #999; padding: 10px;}
	.check-column {width: 60px !important;}
	.organization-table {width: 100%; border: 1px solid #555;}
	.organization-table th {border-bottom: 1px solid #555; background-color: #ddd; border-right: 1px solid #555; text-align: left; padding: 4px;}
	.organization-table tr {border-bottom: 1px solid #555;}
	.organization-table td {border-right: 1px solid #555; padding: 4px; text-align: left;}
	.org_table1 td{padding:2px;}
	.org_table1 .org_td1{padding-top:10px;}
	.org_table1 input[type='text']{width:300px;}
	.org_table1 .org_table_menu1{float:left; padding:0 20px 0 5px; cursor:pointer}
	.org_table1 .org_table_menu1:hover{ text-decoration:underline}
	.org_table1 .org_icon_dn{background:url(/static/images/configuration/sort_dn.gif) no-repeat right center}
	.org_table1 .org_icon_up{background:url(/static/images/configuration/sort_up.gif) no-repeat right center}	
	.org_table1 .org_table_menu_child1{float:left; text-indent:30px; font-size:12px}	
	.org_table1_selected,.org_edit_selected{ background-color:#56a033 !important;}	
	.lean-overlay .loading {width: 128px; height: 128px; display: block; border-radius: 100px; position: absolute; left: 50%; top: 300px; margin-left: -64px;}	
	.organization_next{float:left; width:100%; color:#333 !important; text-decoration:none !important;}	
	.expand_title_parent{ display:none}
	.org_logo_remmove {float:right; background: #fff center url(/static/images/moderator-delete-icon.png) no-repeat; width: 12px; height: 11px; border: solid 1px #ddd; border-radius: 1px; }
</style>

<div class="organization_main1" style="margin-bottom:20px; margin-top:20px;">
    <div class="expand_title expand_title_collapse" id="org4">Main Page Configuration<div class="icon"></div></div>
    <div class="expand_div">
    	<div style="padding: 1em 7px 7px 7px;">        	      
        	<table width="800" border="0" class="org_table1">
            	<tr>
                	<td width="220" class="org_td1">Site URL: </td>
                    <td colspan="2"><input type="text" id="organizational_base_site_url" ></td>
                </tr>
            	<tr>
                	<td class="org_td1">Top Main Logo: </td>
                    <td id="organizational_base_top_main_logo_p"></td>
                    <td width="70"></td>
            	</tr>
                <tr>
                	<td width="220" class="org_td1">Main Logo Text: </td>
                    <td colspan="2"><input type="text" id="organizational_base_main_logo_text" ></td>
                </tr>
                <tr>
                	<td class="org_td1">Bottom Main Logo: </td>
                    <td id="organizational_base_bottom_main_logo_p"></td>
                    <td></td>
                </tr>
                <tr>
                	<td class="org_td1">Main Page Bottom Image: </td>
                    <td id="organizational_base_main_page_bottom_image_p"></td>
                    <td></td>
                </tr>
            	<tr>
                	<td class="org_td1">Main Page Button Text: </td>
                    <td colspan="2"><input type="text" id="organizational_base_main_page_button_text" ></td>
                </tr>
            	<tr>
                	<td class="org_td1">Main Page Button Link: </td>
                    <td colspan="2"><input type="text" id="organizational_base_main_page_button_link" ></td>
                </tr>
            </table>
			<div style="width:100%; text-align:right; height:30px;">
                <input type="button" id="org_btn_main_save" value="Save" class="small_btn" />
            </div>
        </div>        
    </div>
</div>

<div class="organization_main">
	<div style="width:600px;">
        <table id="organization-table" class="organization-table">
            <thead>
                <tr>
                    <th>Organization</th>
                    <th class="check-column sorter-false filter-false"><input type="checkbox" value="1" class="organization-select-all"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="permission-actions">
            <div id="organization-pager" class="pager">            
                <img src="/static/js/tablesorter/css/images/first.png" class="first"/>
                <img src="/static/js/tablesorter/css/images/prev.png" class="prev"/>
                <span class="pagedisplay"></span> <!-- this can be any element, including an input -->
                <img src="/static/js/tablesorter/css/images/next.png" class="next"/>
                <img src="/static/js/tablesorter/css/images/last.png" class="last"/>
                <select class="pagesize">
                	<option value="5">5</option>
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                </select>
            </div>
            <input type="button" name="submit" id="del-organization" value="REMOVE SELECTED" class="small_btn" />
            <input type="button" name="submit" id="new-organization" value="ADD" class="small_btn" />
        </div>
    </div>
</div>

<div class="organization_main1 expand_title_parent">
    <div class="expand_title expand_title_collapse" id="org1">Organization Structure<div class="icon"></div></div>
    <div class="expand_div">
        <div style="padding: 1em 7px 7px 7px;">
        	<table width="550" border="0" class="org_table1">
            	<tr>
                	<td width="220" class="org_td1">Organization Name: </td>
                    <td><input type="text" id="organizational_base_name" disabled="disabled" style="background-color:#CCCCCC"></td>
                </tr>
                <tr>
                	<td class="org_td1">Substitute for District: </td>
                    <td><input type="text" id="organizational_base_for_district"></td>
                </tr>
                <tr>
                	<td class="org_td1">Substitute for School: </td>
                    <td><input type="text" id="organizational_base_for_school"></td>
                </tr>
                <tr>
                	<td class="org_td1">Organization Specific Items: </td>
                    <td>
                    	<table id="organization-table2" class="organization-table">
                            <thead><tr><th>Name</th><th><input type="checkbox" value="" id="organization-table2_all"></th></tr></thead>
                            <tbody>
                            	<!--Top Menu-->
                                <tr>
                                    <td width="300"><span class="org_table_menu1 org_icon_up" id="org_top_menu">Top Menu</span></td>
                                    <td class="check-column"><input type="checkbox" value="" child_check="org_top_menu" class="org_parent_menu organization-item-select"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_top_menu">Courses & Workshop</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tm_course_workshop"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_top_menu">Communities</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tm_communities"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_top_menu">My Chunks</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tm_my_chunks"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_top_menu">Resources</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tm_resources"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_top_menu">People</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tm_people"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_top_menu">Notifications</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tm_notifications"></td>
                                </tr>
                                <!--Tools menu-->
                                <tr>
                                    <td><span class="org_table_menu1 org_icon_up" id="org_tools_menu">Tools menu</span></td>
                                    <td class="check-column"><input type="checkbox" value="" child_check="org_tools_menu" class="org_parent_menu organization-item-select"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Configuration</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_configuration"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Pepper PD Planner</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_pepper_pd_planner"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">PepConn</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_pepconn"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Roles & Permissions</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_roles_permissions"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Time Report</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_time_report"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Reporting</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_reporting"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">SSO Metadata</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_sso_metadata"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">TNL Configuration</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_tnl_configuration"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Studio</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_studio"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Alert</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_alert"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Notifications</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_notifications"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Usage Report</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_usage_report"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_tools_menu">Portfolio Settings</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_tsm_portfolio_settings"></td>
                                </tr>
                                <tr>
                                    <td width="300"><span class="org_table_menu1 org_icon_up" id="org_registration_page">Registration Page</span></td>
                                    <td class="check-column"><input type="checkbox" child_check="org_registration_page" class="org_parent_menu organization-item-select"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_registration_page">Major Subject Area</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_rg_major_subject"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_registration_page">Grade Level-Check all that apply</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_rg_grade_level"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_registration_page">Number of Years in Education</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_rg_number_of"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_registration_page">My Learners' Profile</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_rg_my_learners"></td>
                                </tr>
                                <tr class="org_table_tr_menu">
                                    <td><span class="org_table_menu_child1 org_registration_page">About me</span></td>
                                    <td><input type="checkbox" class="organization-item-select" id="org_rg_about_me"></td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
            </table>
            <div style="width:100%; text-align:right; height:30px;">	
				<input type="button" id="org_btn_first_next" value="Next" class="small_btn" />
                <input type="button" value="Save" class="small_btn org_btn_last_save" />
            </div>
        </div>
    </div>
</div>

<div class="organization_main1 expand_title_parent">
    <div class="expand_title expand_title_collapse" id="org2">Organization Districts<div class="icon"></div></div>
    <div class="expand_div">
        <select id="org_state_select" style="width:200px;">
        	<option value="">Select State</option>
            %for item in State.objects.all().order_by("name"):
            <option value="${item.id}">${item.name}</option>
            %endfor
        </select>
        <select id="org_district_select" style="width:300px;"></select>
        <select id="org_school_select" style="width:300px;"></select>
        
        &nbsp;&nbsp;<input type="button" id="org_btn_add_state" value="ADD" class="small_btn" />
        <input type="button" id="org_btn_fix_state" value="EDIT" class="small_btn" />
        <input type="button" id="org_btn_cancel_state" value="CANCEL" class="small_btn" />
        <input type="button" id="org_btn_reset_state" value="RESET" class="small_btn" />
        
        <div style="width:500px; margin-top:10px;">
            <table id="organization-state-table" class="organization-table">
                <thead>
                    <tr>
                        <th width="200">Entity type</th>
                        <th width="400">Entity</th>
                        <th class="check-column sorter-false filter-false"><input type="checkbox" value="1" class="organization-state-select-all"></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div id="organization-state-actions" style="height:30px;">
                <div id="organization-state-pager" class="pager" style="margin-right:100px;">            
                    <img src="/static/js/tablesorter/css/images/first.png" class="first"/>
                    <img src="/static/js/tablesorter/css/images/prev.png" class="prev"/>
                    <span class="pagedisplay"></span> <!-- this can be any element, including an input -->
                    <img src="/static/js/tablesorter/css/images/next.png" class="next"/>
                    <img src="/static/js/tablesorter/css/images/last.png" class="last"/>
                    <select class="pagesize">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                </div>
                <input type="button" id="organization-state-remove" value="REMOVE SELECTED" class="small_btn" />
            </div>
        </div>
        <div style="width:100%; text-align:right; height:30px;">
            <input type="button" id="org_btn_second_next" value="Next" class="small_btn" />
            <input type="button" value="Save" class="small_btn org_btn_last_save" />
        </div>
    </div>
</div>

<div class="organization_main1 expand_title_parent" style="margin-bottom:20px;">
    <div class="expand_title expand_title_collapse" id="org3">Organization Attributes<div class="icon"></div></div>
    <div class="expand_div">
    	<div style="padding: 1em 7px 7px 7px;">
        	      
        	<table width="800" border="0" class="org_table1">
            	<tr>
                	<td width="230" class="org_td1">Home Page Logo(100&times;100px): </td>
                    <td id="organizational_base_home_logo_p"></td>
                    <td width="70"></td>
            	</tr>
                <tr>
                	<td class="org_td1">Profile Logo(100&times;100px): </td>
                    <td id="organizational_base_profile_logo_p"></td>
                    <td></td>
                </tr>
                <tr>
                	<td class="org_td1">Motto: </td>
                    <td colspan="2"><textarea id="organizational_base_motto" name="organizational_base_motto" cols="50"></textarea></td>
                </tr>
            </table>
			<div style="width:100%; text-align:right; height:30px;">
                <input type="button" value="Save" class="small_btn org_btn_last_save" />
            </div>
        </div>        
    </div>
</div>

<input type="hidden" name="csrfmiddlewaretoken" value="${csrf_token}"/>

<div style="" id="dialog" class="modal">
    <div class="inner-wrapper" style="border:0;border-radius:5px;padding:0">
        <div class="titlebar">
            <h3 class="dialog-title"></h3>
            <div class="close-modal" id="dialog_close">✕</div>
        </div>
        <div class="content"></div>
    </div>
</div>

<div style="" id="dialogYesNo" class="modal">
    <div class="inner-wrapper" style="border:0;border-radius:5px;padding:0">
        <div class="titlebar">
            <h3 class="dialog-title"></h3>
            <div class="close-modal" id="dialog_close">✕</div>
        </div>
        <div class="content"></div>
    </div>
</div>

<script type="text/javascript">
	var org_current_id = "";
	var open_org2 = false;
	var open_org3 = false;
	
	//-----------------------------------------------------------------------organization_district__school_list
	var organization_district_list = new Array();
	var organization_school_list = new Array();
	
	%for item in District.objects.all().order_by("name"):
		organization_district_list.push("${item.state.id},${item.id},${item.name}");
		
		%for item1 in School.objects.filter(district=item).order_by("name"):
		organization_school_list.push("${item1.district.id},${item1.id},${item1.name}");
		%endfor
	%endfor
	
	//-----------------------------------------------------------------------LoadingWin
	function LoadingWin(){
        this.$loader = null;
        this.show();
    }
    LoadingWin.prototype.show = function () {
        if (!this.$loader) {
            this.$loader = $('<div class="lean-overlay"><img class="loading" src="/static/images/loading.gif"></div>');
            this.$loader.appendTo(document.body);
        }
        this.$loader.css('display','block');
    };
    LoadingWin.prototype.hide = function () {
        if (this.$loader) {
            this.$loader.remove();
            this.$loader = null;
        }
    };
	
	//-----------------------------------------------------------------------pagerOptions
	var pagerOptions = {
		container: '',
		// output string - default is '{page}/{totalPages}'; possible variables: {page}, {totalPages}, {startRow}, {endRow} and {totalRows}
		output: '{startRow} - {endRow} ({totalRows})',
		fixedHeight: false,
		removeRows: false,
		page: 0,
		size: 10,
		ajaxUrl: null,
		customAjaxUrl: function(table, url) { return url; },
		ajaxObject: { dataType: 'json' },
		ajaxProcessing: null,
		processAjaxOnInit: true,
		pageReset: 0,
		countChildRows: false,
		cssNext: '.next', // next page arrow
		cssPrev: '.prev', // previous page arrow
		cssFirst: '.first', // go to first page arrow
		cssLast: '.last', // go to last page arrow
		cssGoto: '.gotoPage', // select dropdown to allow choosing a page
		cssPageDisplay: '.pagedisplay', // location of where the "output" is displayed
		cssPageSize: '.pagesize', // page size selector - select dropdown that sets the "size" option
		cssDisabled: 'disabled', // Note there is no period "." in front of this class name
		cssErrorRow: 'tablesorter-errorRow' // ajax error information row
	};
	var tablesorterOptions = {
		theme: 'blue',
		widthFixed: true,
		widgets: ["zebra", "filter"],
		widgetOptions: {
			filter_columnFilters: true,
			filter_placeholder: {search: 'Search...'},
			filter_saveFilters: false
		}
	};
	
	//-----------------------------------------------------------------------A loading status throbber setup.
	function LoadingStatus(list) {
		var self = this;
		setTimeout(function () {
			if (!self.checkStatus()) {
				self.showLoader();
			}
		}, 200);
		this.$list = {};
		$.each(list, function(i, v) {
			self.$list[v] = true;
		});
	}
	// Shows the loader.
	LoadingStatus.prototype.showLoader = function () {
		if (!this.$loader) {
			this.$loader = $('<div class="lean-overlay"><img class="loading" src="/static/images/loading.gif"></div>');
			this.$loader.appendTo(document.body);
		}
		this.$loader.css('display','block');
	};
	// Hides the loader.
	LoadingStatus.prototype.hideLoader = function () {
		if (this.$loader) {
			this.$loader.remove();
			this.$loader = null;
		}
	};
	// Checks the status of all operations.
	LoadingStatus.prototype.checkStatus = function () {
		var status = true;
		$.each(this.$list, function(i, v) {
			if (v) {
				status = false;
			}
		});
		return status;
	};
	// Sets the current status for an operation.
	LoadingStatus.prototype.setStatus = function (name) {
		this.$list[name] = false;
		this.loaderCheck();
	};
	// Checks the status and hides the loader if appropriate.
	LoadingStatus.prototype.loaderCheck = function () {
		if (this.checkStatus()) {
			this.hideLoader();
		}
	};
	
	//-----------------------------------------------------------------------checkOrganization
	function checkOrganization(name, oid) {
		var valid = true;
		var error = '';
		$.ajax({
			url: "${reverse('organizational_configuration')}",
			type: 'GET',
			async: false,
			data: {flag: 'checkPost', name: name, oid: oid},
			success: function(data) {
				valid = data.success;
				error = data.Error;
			}
		});
		if (valid) {
			return true;
		} else {
			return error;
		}
	}
	
	//-----------------------------------------------------------------------validateOrganizationForm
	function validateOrganizationForm(type) {
		$('.error-box').removeClass('error-box');
		var valid = true;
		var errors = ['The following errors occurred:\n'];
		var name = $('#new-organizational-submit input[name="organizational_name"]');
		var oid = $('#new-organizational-submit input[name="oid"]');
		
		if (!/[A-Za-z0-9]+/.test(name.val())) {
			valid = false;
			errors.push('Name is required.');
			name.addClass('error-box');
		}		
		
		var check_permission = checkOrganization(name.val(), oid.val());
		if (check_permission !== true) {
			valid = false;
			errors.push(check_permission);
			name.addClass('error-box');
		}
		
		if (!valid) {
			var error = errors.join('\n');
			alert(error);
		}
		return valid;
	}	
		
	//-----------------------------------------------------------------------postForm
	function postForm(form, dialog, callback, passthrough) {
		var params = $(form).serialize();
		$.post($(form).attr('action'), params, function (data) {
			if (data.Success) {
				if (dialog) {
					dialog.hide();
				}
				if ($.isFunction(callback)) {
					if (typeof passthrough !== 'undefined') {
						callback(passthrough);
					} else {
						callback();
					}
				}
			} else {
				if (data.hasOwnProperty('Error') && data.Error == 'duplicate') {
					alert("This item is already part of this group. It can't be added again.")
				} else {
					alert('There was an error processing this request. Please contact the site admins for help.');
				}
			}
		});
	}
	
	//-----------------------------------------------------------------------organizationEditAttach
	function organizationEditAttach() {		
		$('.permission-edit').click(function (e) {
			e.preventDefault();
			var id = $(this).attr('href').substr(1);
			organizationEdit('edit', id);
		});
	}		
	
	//-----------------------------------------------------------------------organizationEdit
	function organizationEdit(type, id) {
		var button_name = 'Add';
		var dialog_title = 'New Organization';
		var name = '';
		var url = '';
		if (type == 'edit') {
			button_name = 'Save';
			dialog_title = 'Edit Organization';
			$.ajaxSettings.async = false; 
			$.getJSON("${reverse('organizational_configuration')}", {flag:"organization_list", oid: id}, function (r) {
				if (r.success) {
					if(r.rows.length > 0){
						for(var i in r.rows){
							name = r.rows[i].OrganizationName;
							url = r.rows[i].url;
						}
					}
				}
			});
			$.ajaxSettings.async = true;
		}
		
		var content = '<form action="${reverse('organizational_configuration')}" method="post" id="new-organizational-submit">';
		content += '<label>Organization Name:<input type="text" name="organizational_name" value="' + name + '"></label>';
		if (type == 'edit') {
			content += '<input type="hidden" name="oid" value="' + id + '"/>';
		}else{
			content += '<input type="hidden" name="oid" value="-1"/>';
		}
		content += '<input type="hidden" name="flag" value="organization_add"/>';
		content += '<input type="submit" name="submit" value="' + button_name + '"></label>';
		content += '</form>';
		
		var dialog = new Dialog('#dialog');
		dialog.show(dialog_title, content);
		
		$('#new-organizational-submit').submit(function (event) {
			event.preventDefault();
			if (validateOrganizationForm(type)) {
				postForm(this, dialog, updateOrganizations);
			}
		});
	}
	
	//-----------------------------------------------------------------------selectAll
	function selectAll(trigger_selector, target_selector) {
		$(trigger_selector).change(function () {
			var checked = false;
			if ($(this).is(':checked')) {
				checked = true;
			}
			$(target_selector).each(function () {
				$(this).prop('checked', checked);
			});
		});
	}
	
	//-----------------------------------------------------------------------updateOrganizations
	function updateOrganizations() {
		$(".expand_title_parent").hide();
		
		$('#organization-table tbody .data').remove();
		$('.organization-select-all:checked').prop({checked: false});		
		$.getJSON("${reverse('organizational_configuration')}", {flag:"organization_list"}, function (r) {
			if (r.success) {
				if(r.rows.length > 0){
					for(var i in r.rows){
						var row = '<tr class="data">';
						row += '<td><a href="#' + r.rows[i].id + '" class="organization_next">' + r.rows[i].OrganizationName + '</a></td>';
						row += '<td class="check-column">';
						row += '<input type="checkbox" value="' + r.rows[i].id + '" class="organization-select">&nbsp;';
						row += '<a href="#' + r.rows[i].id + '" class="permission-edit"><img src="/static/images/portal-icons/pencil-icon.png"></a>';
						row += '</td>';
						row += '</tr> ';
						$('#organization-table tbody').append(row);
					}
					organizationEditAttach();
					
					$(".organization_next").click(function(e){
						e.preventDefault();
						var loadwin = new LoadingWin();
						
						org_current_id = $(this).attr('href').substr(1);
						var org_current_name = $(this).text();
						
						$(".org_table1_selected").removeClass("org_table1_selected");
						$(this).parent().addClass("org_table1_selected");
						$(this).parent().next().addClass("org_table1_selected");
						
						$("#org_btn_first_next").parent().show();
						$("#org_btn_second_next").parent().show();
						
						$.get("${reverse('organizational_configuration')}", {flag: "organization_get", oid: org_current_id}, function (r) {							
							if (r.Success){
								if(r.find){	
									$("#org_btn_reset_state").click();
									$(".expand_title_parent").show();
									organizationAddFileImg("organizational_base_home_logo", r.home_logo);
									organizationAddFileImg("organizational_base_profile_logo", r.profile_logo);
									
									organizationAddFileImgInit("organizational_base_home_logo");
									organizationAddFileImgInit("organizational_base_profile_logo");
									
									$(".organization-item-select").attr("checked", false);									
									$(".organization-state-select").parent().parent().remove();
									$('#organization-state-table').trigger('update');
									$("#organizational_base_name").val(org_current_name);
									
									//----------
									if(r.specific_items != ""){
										var tmp_specific_items = eval("(" + r.specific_items + ")");
										for(var tmpx in tmp_specific_items){
											$("#" + tmpx).attr("checked", true);
										}									
									}
									
									//----------
									if(r.sid_did != ""){
										var sid_did_list = r.sid_did.split(":");
										for(var j in sid_did_list){
											var tmpsd = sid_did_list[j].split(",");
											organizationAddDistricts(tmpsd[0], tmpsd[2], tmpsd[1]);
										}
									}
									//----------
									$("#organizational_base_for_district").val(r.DistrictType);
									$("#organizational_base_for_school").val(r.SchoolType);										
									$("#organizational_base_motto").val(r.motto);
									
									if(r.New){
										//----------
										$(".expand_title_parent").each(function(i){
											var $div = $(this).find(".expand_title").next("div.expand_div");
											if(i != 0){
												if ($div.is(':visible')) {
													$div.slideUp();
													$(this).removeClass("expand_title_expanded");
												}
											}else{
												if (!$div.is(':visible')) {
													$div.slideDown();
													$(this).addClass("expand_title_expanded");
												}
											}
										});
										//----------
										$("#org_btn_first_next").show();
										$("#org_btn_second_next").show();
										$(".org_btn_last_save").eq(0).hide();
										$(".org_btn_last_save").eq(1).hide();
										
										open_org2 = false;
										open_org3 = false;
									}else{
										//----------
										$("#org_btn_first_next").hide();
										$("#org_btn_second_next").hide();										
										$(".org_btn_last_save").eq(0).show();
										$(".org_btn_last_save").eq(1).show();
										
										open_org2 = true;
										open_org3 = true;
									}
								}
							}else{
								alert("error: " + r.Error);
							}
							loadwin.hide();
						});
					});
				}
				$('#organization-table').trigger('update');
			}
		});
	}	
	
	//-----------------------------------------------------------------------organizationAddFileImgInit
	function organizationAddFileImgInit(eid){
		$("#" + eid + "_p").empty();
		$("#" + eid + "_p").append('<input type="file" id="' + eid + '" name="' + eid + '">');
	}	
	
	//-----------------------------------------------------------------------organizationAddFileImg
	function organizationAddFileImg(flag_new, eid, name){
		if(org_current_id != ""){
			$("#" + eid + "_p").next().empty();
			if(name){
				var src = "/static/uploads/organization/" + org_current_id + "/" + name;				
				$("#" + eid + "_p").next().append('<a href="' + src + '" target="_blank"><img src="' + src + '?r=' + Math.random() + '" width="50" /></a><a href="#" class="org_logo_remmove" onclick="org_logo_remmove(\'' + eid + '\')"></a>');
			}
		}
	}
	
	//-----------------------------------------------------------------------organizationAddMainFileImg
	function organizationAddMainFileImg(eid, name){		
		$("#" + eid + "_p").next().empty();
		if(name){
			var src = "/static/uploads/organization/main_page/" + name;
			$("#" + eid + "_p").next().append('<a href="' + src + '" target="_blank"><img src="' + src + '?r=' + Math.random() + '" width="50" /></a><a href="#" class="org_logo_remmove" onclick="org_logo_remmove(\'' + eid + '\')"></a>');
		}		
	}
	
	//-----------------------------------------------------------------------organizationAddDistricts
	function organizationAddDistricts(add_type, add_txt, add_id){
		var row = '<tr class="data">';
		row += '<td>' + add_type + '</td>';
		row += '<td>' + add_txt + '</td>';
		row += '<td class="check-column">';
		row += '<input type="checkbox" class="organization-state-select">&nbsp;';
		row += '<a href="javascript:void(0)" sid="' + add_id + '" stype="' + add_type + '" class="permission-edit organization-state-edit"><img src="/static/images/portal-icons/pencil-icon.png"></a>';
		row += '</td>';
		row += '</tr> ';
		$('#organization-state-table tbody').append(row);
		
		//-----------------------------------------edit
		$(".organization-state-edit").click(function(e){
			e.preventDefault();
			
			$(".org_edit_selected").removeClass("org_edit_selected");
			$(this).parent().addClass("org_edit_selected");
			$(this).parent().prev().addClass("org_edit_selected");
			$(this).parent().prev().prev().addClass("org_edit_selected");
			
			var stype = $(this).attr("stype");
			var sid = $(this).attr("sid");
			if(stype == "State"){
				$("#org_state_select").val(sid);
				$("#org_state_select").change();
				
			}else if(stype == "District"){
				for(var i = 0; i < organization_district_list.length; i++){
					var tmp1 = organization_district_list[i].split(",");
					if(tmp1[1] == sid){
						$("#org_state_select").val(tmp1[0]);
						$("#org_state_select").change();
						break;
					}
				}
				$("#org_district_select").val(sid);
				$("#org_district_select").change();
			}else{
				for(var i = 0; i < organization_school_list.length; i++){
					var tmp1 = organization_school_list[i].split(",");
					if(tmp1[1] == sid){									
						for(var j = 0; j < organization_district_list.length; j++){
							var tmp2 = organization_district_list[j].split(",");
							if(tmp2[1] == tmp1[0]){
								$("#org_state_select").val(tmp2[0]);
								$("#org_state_select").change();
								break;
							}
						}
						$("#org_district_select").val(tmp1[0]);
						$("#org_district_select").change();
						break;
					}
				}
				$("#org_school_select").val(sid);
			}
			$("#org_btn_fix_state").attr("sid", sid);
			$("#org_btn_fix_state").attr("stype", stype);
			$("#org_btn_fix_state").show();
			$("#org_btn_cancel_state").show();
			
			$("#org_btn_add_state").hide();
		});
		
		$('#organization-state-table').trigger('update');
	}
	
	//-----------------------------------------------------------------------organizationUploadFile
	function organizationUploadFile(fileElementId, file_type){
		if($("#" + fileElementId).val() != ""){
			var loadwin = new LoadingWin();
			$.ajaxFileUpload({
				url: "${reverse('organizational_configuration')}", 
				secureuri: false,
				fileElementId: fileElementId,
				dataType: 'JSON',
				data: {flag: 'org_upload', file_type: file_type, csrfmiddlewaretoken: '${csrf_token}', oid: org_current_id},
				success: function (data, status){
					var tmp2 = eval("(" + $(data).html() + ")");
					if(tmp2.Success){
						organizationAddFileImgInit(fileElementId);
						organizationAddFileImg(fileElementId, tmp2.name);
					}else{
						alert("ajaxFileUpload error: " + tmp2.Error);
					}
					loadwin.hide();
				},
				error: function (data, status, e){
					alert("ajaxFileUpload error: " + e);
					loadwin.hide();
				}
			})
		}
	}
	
	//-----------------------------------------------------------------------organizationMainUploadFile
	function organizationMainUploadFile(fileElementId, file_type, mid){
		if($("#" + fileElementId).val() != ""){
			var loadwin = new LoadingWin();
			$.ajaxFileUpload({
				url: "${reverse('organizational_configuration')}", 
				secureuri: false,
				fileElementId: fileElementId,
				dataType: 'JSON',
				data: {flag: 'org_main_upload', file_type: file_type, csrfmiddlewaretoken: '${csrf_token}'},
				success: function (data, status){
					var tmp2 = eval("(" + $(data).html() + ")");
					if(tmp2.Success){
						organizationAddFileImgInit(fileElementId);
						organizationAddMainFileImg(fileElementId, tmp2.name);
					}else{
						alert("ajaxFileUpload error: " + tmp2.Error);
					}
					loadwin.hide();
				},
				error: function (data, status, e){
					alert("ajaxFileUpload error: " + e);
					loadwin.hide();
				}
			})
		}
	}
	
	//-----------------------------------------------------------------------organizationCheckUploadFile
	function organizationCheckUploadFile(filename){
		var tmp1 = filename.substring(filename.length - 4);
		if(tmp1 == ".gif" || tmp1 == ".jpg" || tmp1 == ".jpeg" || tmp1 == ".png"){			
			return true;
		}else{			
			return false;
		}		
	}
	
	//-----------------------------------------------------------------------org_logo_remmove
	function org_logo_remmove(eid){
		if(confirm("Are you sure to delete the image?")){
			var loadwin = new LoadingWin();
			var db = "attributes";
			var column = "";
			if(eid == "organizational_base_top_main_logo"){
				db = "configuration";
				column = "TopMainLogo";
			}else if(eid == "organizational_base_bottom_main_logo"){
				db = "configuration";
				column = "BottomMainLogo";
			}else if(eid == "organizational_base_main_page_bottom_image"){
				db = "configuration";
				column = "MainPageBottomImage";
			}else if(eid == "organizational_base_home_logo"){
				column = "LogoHome";
			}else if(eid == "organizational_base_profile_logo"){
				column = "LogoProfile";
			}
			$.post("${reverse('organizational_configuration')}", {flag: "organization_remove_img", oid: org_current_id, column: column, db: db}, function (r) {	
				if (r.Success){
					$("#" + eid + "_p").next().empty();
				}
				loadwin.hide();
			});
		}
	}
		
	//-----------------------------------------------------------------------document ready
    $(document).ready(function() {
		$("#org_btn_fix_state").hide();
		$("#org_btn_cancel_state").hide();
		
		organizationAddFileImgInit("organizational_base_home_logo");
		organizationAddFileImgInit("organizational_base_profile_logo");
		organizationAddFileImgInit("organizational_base_top_main_logo");
		organizationAddFileImgInit("organizational_base_bottom_main_logo");
		organizationAddFileImgInit("organizational_base_main_page_bottom_image");
		
		//--------------------------organization-table2_all
		$("#organization-table2_all").change(function(){
			var checked = false;
			if ($(this).is(':checked')) {
				checked = true;
			}
			$(".organization-item-select").prop('checked', checked);
		});
		
		//--------------------------org_parent_menu
		$(".org_parent_menu").change(function(){
			var tmp1 = $(this).attr("child_check");
			var checked = false;
			if ($(this).is(':checked')) {
				checked = true;
			}
			$("." + tmp1).parent().next().find("input[type='checkbox']").prop('checked', checked);
		});
		
		//--------------------------organization_main_get
		$.get("${reverse('organizational_configuration')}", {flag:"organization_main_get"}, function (r) {			
			if (r.Success){
				 if(r.flag_new){
					$("#organizational_base_site_url").val("");
					$("#organizational_base_main_logo_text").val("");
					$("#organizational_base_main_page_button_text").val("");
					$("#organizational_base_main_page_button_link").val("");
					$("#org_btn_main_save").attr("mid", "-1");
				 }else{
					if(r.TopMainLogo != "")			organizationAddMainFileImg("organizational_base_top_main_logo", r.TopMainLogo);
					if(r.BottomMainLogo != "")		organizationAddMainFileImg("organizational_base_bottom_main_logo", r.BottomMainLogo);
					if(r.MainPageBottomImage != "")	organizationAddMainFileImg("organizational_base_main_page_bottom_image", r.MainPageBottomImage);					
					
					$("#org_btn_main_save").attr("mid", r.mid);
					$("#organizational_base_site_url").val(r.SiteURL);
					$("#organizational_base_main_logo_text").val(r.MainLogoText);
					$("#organizational_base_main_page_button_text").val(r.MainPageButtonText);
					$("#organizational_base_main_page_button_link").val(r.MainPageButtonLink);
				 }
			}else{
				alert(r.Error);
			}
		});
		
		//--------------------------org_table_menu1
		$(".org_table_menu1").click(function(){
			var mid = $(this).attr("id");
			if($(this).hasClass("org_icon_dn")){
				$(this).addClass("org_icon_up");
				$(this).removeClass("org_icon_dn");
				$("." + mid).parent().parent().show();
			}else{
				$(this).addClass("org_icon_dn");
				$(this).removeClass("org_icon_up");
				$("." + mid).parent().parent().hide();
			}
		});
		
		//--------------------------expand_title
		$(".expand_title").click(function () {
			var tmp1 = false;
			var thisId = $(this).attr("id");
			if(thisId == "org4"){
				tmp1 = true;
			}else if(org_current_id != ""){
				if(thisId == "org3" && open_org3){
					tmp1 = true;
				}else if(thisId == "org2" && open_org2){
					tmp1 = true;
				}else if(thisId == "org1"){
					tmp1 = true;
				}
			}
			if(tmp1){
				var $div = $(this).next("div.expand_div");
				if ($div.is(':visible')) {
					$div.slideUp();
					$(this).removeClass("expand_title_expanded");
				} else {
					$div.slideDown();
					$(this).addClass("expand_title_expanded");
				}
			}
		});
	
		//--------------------------Sets up the tablesorter tables for the 4 tables on the page.
		pagerOptions.container = $("#organization-pager");
		$('#organization-table').tablesorter(tablesorterOptions).tablesorterPager(pagerOptions);		
		
		pagerOptions.container = $("#organization-state-pager");
		$('#organization-state-table').tablesorter(tablesorterOptions).tablesorterPager(pagerOptions);		
		
		//--------------------------new-organization
		$('#new-organization').click(function () {
			organizationEdit('add');
		});
		
		//--------------------------
		organizationEditAttach();
		
		//--------------------------del-organization
		$('#del-organization').click(function () {
			if($(".organization-select:checked").length > 0){
				var dialog = new Dialog('#dialogYesNo');
				dialog.showYesNo('Delete Organization(s)', 'Are you sure you want to delete this organization(s)? This action cannot be undone.', function(answer) {
					if (answer) {
						var ids = "";
						$(".organization-select:checked").each(function(){
							if(ids != "") ids += ",";
							ids += $(this).val();
						});
						if(ids != ""){
							$.post("${reverse('organizational_configuration')}", {flag:"organization_delete", ids: ids}, function (r) {
								if (r.Success){
									updateOrganizations();
									dialog.hide();
								}else{
									alert(r.Error);
								}
							});
						}else{
							dialog.hide();
						}
					} else {
						dialog.hide();
					}
				});
			}
		});		
		
		//--------------------------Initialize the select all checkboxes.
		selectAll('.organization-select-all', '.organization-select');
		selectAll('.organization-state-select-all', '.organization-state-select');
		
		updateOrganizations();
		
		//--------------------------org_btn_first_next
		$('#org_btn_first_next').click(function () {
			$(this).parent().hide();

			var $div = $("#org2").next("div.expand_div");
			$div.slideDown();
			$(this).addClass("expand_title_expanded");
			
			open_org2 = true;
		});
		
		//--------------------------org_btn_second_next
		$('#org_btn_second_next').click(function () {
			$(this).parent().hide();
			
			var $div = $("#org3").next("div.expand_div");
			$div.slideDown();
			$(this).addClass("expand_title_expanded");
			
			open_org3 = true;
		});
		
		//--------------------------org_school_select_add
		function checkInList(id, ids){
			for(var i = 0; i < ids.length; i++){
				if(ids[i] == id){
					return true;
				}
			}
			return false;
		}
		function org_school_select_add(district_ids){
			$("#org_school_select option").remove();
			$("#org_school_select").append("<option value=''>Select School</option>");
			for(var i = 0; i < organization_school_list.length; i++){
				var tmp1 = organization_school_list[i].split(",");
				if(district_ids == null || (district_ids.length > 0 && checkInList(tmp1[0], district_ids))){
					$("#org_school_select").append("<option value='" + tmp1[1] + "'>" + tmp1[2] + "</option>");
				}
			}
		}
		
		//--------------------------org_district_select_add
		function org_district_select_add(state_id){
			$("#org_district_select option").remove();
			$("#org_district_select").append("<option value=''>Select District</option>");
			
			var district_ids = new Array();
			for(var i = 0; i < organization_district_list.length; i++){
				var tmp1 = organization_district_list[i].split(",");
				if(state_id == "" || (state_id != "" && tmp1[0] == state_id)){
					$("#org_district_select").append("<option value='" + tmp1[1] + "'>" + tmp1[2] + "</option>");
					district_ids.push(tmp1[1]);
				}
			}
			if(state_id == "")
				org_school_select_add(null);
			else
				org_school_select_add(district_ids);
		}
		org_district_select_add("");		
		
		//--------------------------org_state_select
        $("#org_state_select").change(function () {
			org_district_select_add($(this).val());
        });
		
		 $("#org_district_select").change(function () {		 	
		 	var tmp1 = new Array();
			tmp1.push($(this).val());
			org_school_select_add(tmp1);
        });
		
		//--------------------------org_btn_add_state
		$("#org_btn_add_state").click(function(){
			var loadwin = new LoadingWin();	
			var state_id = $("#org_state_select").val();
			var district_id = $("#org_district_select").val();
			var school_id = $("#org_school_select").val();			
			var add_id = "";
			var add_txt = "";
			var add_type = "";
			
			if(state_id != ""){
				add_id = state_id;
				add_txt = $("#org_state_select option:selected").text();
				add_type = "State";
			}
			if(district_id != ""){
				add_id = district_id;
				add_txt = $("#org_district_select option:selected").text();
				add_type = "District";
			}
			if(school_id != ""){
				add_id = school_id;
				add_txt = $("#org_school_select option:selected").text();
				add_type = "School";
			}
			if(add_id == ""){
				alert("Please select");
				loadwin.hide();
			}else{
				$.post("${reverse('organizational_configuration')}", {flag:"organization_check_Entity", oid: org_current_id, add_id: add_id, add_type: add_type}, function (r) {
					if (r.Success){
						if(r.Add){
							if($(".organization-state-edit[sid='" + add_id + "'][stype='" + add_type + "']").length > 0){
								alert("The " + add_txt + " has been added in this organization.");
								loadwin.hide();
							}else{
								/*}else if(stype == "District"){
									for(var i = 0; i < organization_district_list.length; i++){
										var tmp1 = organization_district_list[i].split(",");
										if(tmp1[1] == sid){
											$("#org_state_select").val(tmp1[0]);
											$("#org_state_select").change();
											break;
										}
									}
									$("#org_district_select").val(sid);
									$("#org_district_select").change();
								}else{
									for(var i = 0; i < organization_school_list.length; i++){
										var tmp1 = organization_school_list[i].split(",");
										if(tmp1[1] == sid){									
											for(var j = 0; j < organization_district_list.length; j++){
												var tmp2 = organization_district_list[j].split(",");
												if(tmp2[1] == tmp1[0]){
													$("#org_state_select").val(tmp2[0]);
													$("#org_state_select").change();
													break;
												}
											}
											$("#org_district_select").val(tmp1[0]);
											$("#org_district_select").change();
											break;
										}
									}
									$("#org_school_select").val(sid);
								}*/
								if(add_type == "District"){
									$(".organization-state-edit").each(function(){
										var sid = $(this).attr("sid");
										var stype = $(this).attr("stype");
										if(stype == "State"){
											
										}
									});
									organizationAddDistricts(add_type, add_txt, add_id);
									loadwin.hide();
								}else if(add_type == "School"){
									organizationAddDistricts(add_type, add_txt, add_id);
									loadwin.hide();
								}else{
									organizationAddDistricts(add_type, add_txt, add_id);
									loadwin.hide();
								}
							}
						}else{
							alert("This item has been added in this/other organization.");
							loadwin.hide();
						}
					}else{
						alert(r.Error);
						loadwin.hide();
					}
				});
			}
		});	
		
		//--------------------------org_btn_reset_state
		$("#org_btn_reset_state").click(function(){		
			$("#org_state_select").val("");
			$("#org_district_select").val("");
			$("#org_school_select").val("");
			org_district_select_add("");
		});	
		
		//--------------------------organization-state-remove
		$('#organization-state-remove').click(function () {
			if($(".organization-state-select:checked").length > 0){
				var dialog = new Dialog('#dialogYesNo');
				dialog.showYesNo('Delete District(s)', 'Are you sure you want to delete the district(s)?', function(answer) {
					if (answer) {
						$(".organization-state-select:checked").parent().parent().remove();
						$('#organization-state-table').trigger('update');
						$("#org_btn_cancel_state").click();
						dialog.hide();
					} else {
						dialog.hide();
					}
				});
			}
		});
		
		//--------------------------org_btn_fix_state
		$('#org_btn_fix_state').click(function () {
			var fix_sid = $(this).attr("sid");
			var fix_stype = $(this).attr("stype");
			
			var state_id = $("#org_state_select").val();
			var district_id = $("#org_district_select").val();
			var school_id = $("#org_school_select").val();			
			var add_id = "";
			var add_txt = "";
			var add_type = "";
			
			if(state_id != ""){
				add_id = state_id;
				add_txt = $("#org_state_select option:selected").text();
				add_type = "State";
			}
			if(district_id != ""){
				add_id = district_id;
				add_txt = $("#org_district_select option:selected").text();
				add_type = "District";
			}
			if(school_id != ""){
				add_id = school_id;
				add_txt = $("#org_school_select option:selected").text();
				add_type = "School";
			}
			
			if(add_id == ""){
				alert("Please select");
			}else{
				var editx = $(".organization-state-edit[sid='" + fix_sid + "'][stype='" + fix_stype + "']");
				if(editx.length > 0 && !editx.parent().hasClass("org_edit_selected")){
					alert("Have been added");
				}else{
					editx.attr("sid", add_id);
					editx.attr("stype", add_type);
					editx.parent().prev().text(add_txt);
					editx.parent().prev().prev().text(add_type);
					$('#org_btn_cancel_state').click();
				}
			}
		});
		
		//--------------------------org_btn_cancel_state
		$('#org_btn_cancel_state').click(function () {
			$("#org_btn_fix_state").hide();
			$("#org_btn_cancel_state").hide();			
			$("#org_btn_add_state").show();			
			$(".org_edit_selected").removeClass("org_edit_selected");
		});
		
		//--------------------------org_btn_last_save 
		$(".org_btn_last_save").click(function(){
			var loadwin = new LoadingWin();
			
			/*if($("#organizational_base_home_logo").val() == "" && $("#organizational_base_home_logo_p").next().html() == ""){
				alert("The following errors occurred:\n\Home Page Logo is required.");
				loadwin.hide();
				return;
			}
			if($("#organizational_base_profile_logo").val() == "" && $("#organizational_base_profile_logo_p").next().html() == ""){
				alert("The following errors occurred:\n\Profile Logo is required.");
				loadwin.hide();
				return;
			}*/
			if($("#organizational_base_home_logo").val() != "" && !organizationCheckUploadFile($("#organizational_base_home_logo").val())){
				alert("Home Page Logo: Please upload image in .gif, .jpg, .jpeg, .png format.");
				loadwin.hide();
				return;
			}
			if($("#organizational_base_profile_logo").val() != "" && !organizationCheckUploadFile($("#organizational_base_profile_logo").val())){				
				alert("Profile Logo: Please upload image in .gif, .jpg, .jpeg, .png format.");
				loadwin.hide();
				return;
			}
			
			var sid_did = "";
			$(".organization-state-edit").each(function(){
				var sid = $(this).attr("sid");
				var stype = $(this).attr("stype");
				if(sid_did != "")	sid_did += ":";
				sid_did += sid + "," + stype;
			});
			
			var for_district = $("#organizational_base_for_district").val();
			var for_school = $("#organizational_base_for_school").val();
			var motto = $("#organizational_base_motto").val();			
			
			var specific_items = "{";
			$(".organization-item-select").each(function(){
				if($(this).attr('checked'))	specific_items += ",'" + $(this).attr("id") + "': true";
			});			
			specific_items = specific_items.replace(",", "");
			specific_items += "}";
			if(specific_items == "{}")	specific_items = "";
			
			/*if (!/[A-Za-z0-9]+/.test(for_district)) {				
				alert("The following errors occurred:\n\Substitute for District is required.");
				loadwin.hide();
				return;
			}
			if (!/[A-Za-z0-9]+/.test(for_school)) {				
				alert("The following errors occurred:\n\Substitute for School is required.");
				loadwin.hide();
				return;
			}*/
			/*if (!/[A-Za-z0-9]+/.test(motto)) {				
				alert("The following errors occurred:\n\Motto is required.");
				loadwin.hide();
				return;
			}*/
			
			$.post("${reverse('organizational_configuration')}", {flag: "organizational_save_base", oid: org_current_id, sid_did: sid_did,
				for_district: for_district,
				for_school: for_school,
				specific_items: specific_items,
				motto: motto
			}, function (r) {
				if (r.Success){
					if($("#organizational_base_home_logo").val() != ""){
						organizationUploadFile("organizational_base_home_logo", "home_logo");
					}
					if($("#organizational_base_profile_logo").val() != ""){
						organizationUploadFile("organizational_base_profile_logo", "profile_logo");
					}
					$("#org_btn_cancel_state").click();
				}else{
					alert(r.Error);
				}
				loadwin.hide();
			});
		});
		
		//--------------------------org_btn_main_save 
		$("#org_btn_main_save").click(function(){
			var loadwin = new LoadingWin();	
		
			/*if($("#organizational_base_top_main_logo").val() == "" && $("#organizational_base_top_main_logo_p").next().html() == ""){
				alert("The following errors occurred:\n\Top Main Logo is required.");
				loadwin.hide();
				return;
			}*/
			if($("#organizational_base_top_main_logo").val() != "" && !organizationCheckUploadFile($("#organizational_base_top_main_logo").val())){
				alert("Top Main Logo: Please upload image in .gif, .jpg, .jpeg, .png format.");
				loadwin.hide();
				return;
			}
			if($("#organizational_base_bottom_main_logo").val() != "" &&!organizationCheckUploadFile($("#organizational_base_bottom_main_logo").val())){
				alert("Bottom Main Logo: Please upload image in .gif, .jpg, .jpeg, .png format.");
				loadwin.hide();
				return;
			}
			if($("#organizational_base_main_page_bottom_image").val() != "" && !organizationCheckUploadFile($("#organizational_base_main_page_bottom_image").val())){
				alert("Main Page Bottom Image: Please upload image in .gif, .jpg, .jpeg, .png format.");
				loadwin.hide();
				return;
			}
			
			var site_url = $("#organizational_base_site_url").val();
			var logo_text = $("#organizational_base_main_logo_text").val();
			var button_text = $("#organizational_base_main_page_button_text").val();
			var button_link = $("#organizational_base_main_page_button_link").val();
			
			/*if (site_url == "") {
				alert("The following errors occurred:\n\Site URL is required.");
				loadwin.hide();
				return;
			}
			if (logo_text == "") {
				alert("The following errors occurred:\n\Main Logo Text is required.");
				loadwin.hide();
				return;
			}
			if (button_text == "") {
				alert("The following errors occurred:\n\Main Page Button Text is required.");
				loadwin.hide();
				return;
			}
			if (button_link == "") {
				alert("The following errors occurred:\n\Main Page Button Link  is required.");
				loadwin.hide();
				return;
			}*/
			
			var mid = $(this).attr("mid");
			$.post("${reverse('organizational_configuration')}", {flag: "organizational_save_main_base", 
				mid: mid,
				site_url: site_url,
				logo_text: logo_text,
				button_text: button_text,
				button_link: button_link
			}, function (r) {
				if (r.Success){
					if($("#organizational_base_top_main_logo").val() != ""){
						organizationMainUploadFile("organizational_base_top_main_logo", "top_main_logo", r.mid);
					}
					if($("#organizational_base_bottom_main_logo").val() != ""){
						organizationMainUploadFile("organizational_base_bottom_main_logo", "bottom_main_logo", r.mid);
					}
					if($("#organizational_base_main_page_bottom_image").val() != ""){
						organizationMainUploadFile("organizational_base_main_page_bottom_image", "main_page_bottom_image", r.mid);	
					}
					$("#org_btn_cancel_state").click();
				}else{
					alert(r.Error);
				}
				loadwin.hide();
			});
		});
    });	
	var csrf_token = '${csrf_token}';
</script>

