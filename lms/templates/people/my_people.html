<%! from django.utils.translation import ugettext as _ %>

<%!
  from django.core.urlresolvers import reverse
  from courseware.courses import course_image_url, get_course_about_section
  from courseware.access import has_access
  from certificates.models import CertificateStatuses
  from xmodule.modulestore import MONGO_MODULESTORE_TYPE
  from xmodule.modulestore.django import modulestore
  from student.models import UserProfile
  from student.models import State,District,Transaction,Cohort,School,SubjectArea,GradeLevel,YearsInEducation
  from baseinfo.models import Enum
%>
<%! import json%>
<style type="text/css" media="screen">
  #btn-dashboard{display:none;}
  section.course-index{
    padding-bottom:50px !important;
  }
</style>
<%namespace name='static' file='/static_content.html'/>
<%inherit file="/main.html" />
<script type="text/javascript" src="/static/js/reg_kits.js" charset="utf-8"></script>
<%block name="title">
%if course:
<title>${_("{course_number} People").format(course_number=course.display_number_with_default) | h}</title>
%else:
<title>${_("People")}</title>
%endif
</%block>
<link rel="stylesheet" type="text/css"  href="/static/tmp-resource/css/people.css"/>
<%block name="headextra">
%if course:
  <%static:css group='course'/>
  <%include file="../discussion/_js_head_dependencies.html" />
  % if show_chat:
    <link rel="stylesheet" href="${static.url('css/vendor/ui-lightness/jquery-ui-1.8.22.custom.css')}" />
    ## It'd be better to have this in a place like lms/css/vendor/candy,
    ## but the candy_res/ folder contains images and other junk, and it
    ## all needs to stay together for the Candy.js plugin to work.
    <link rel="stylesheet" href="${static.url('candy_res/candy_full.css')}" />
  % endif
%endif
</%block>
<style>
/* Button 1 */
.btn-1 {
	border: 3px solid #ccc;
	color: #fff;
	background-image: -webkit-linear-gradient(bottom, #199700, #79d664);
	background-image: -moz-linear-gradient(bottom, #199700, #79d664);
	background-image: -o-linear-gradient(bottom, #199700, #79d664);
	background-image: linear-gradient(to top, #199700, #79d664);
}
/* Button 1a */
.btn-1a:hover, .btn-1a:active {
	color: #0e83cd;
	background-image: -webkit-linear-gradient(bottom, #f93, #e0862c, #f93);
	background-image: -moz-linear-gradient(bottom, #f93, #e0862c, #f93);
	background-image: -o-linear-gradient(bottom, #f93, #e0862c, #f93);
	background-image: linear-gradient(to top, #f93, #e0862c, #f93);
}
</style>
%if course:
  <%include file="/courseware/course_navigation.html" args="active_page='people'" />
%endif
<section class="container">
  %if course:
    <div class="course-wrapper">
    <section class="course-index" style="width:280px !important;height:800px !important;">
  %else:
    <div class="course-wrapper" style="border-left: 1px solid rgb(200, 200, 200) !important;">
    <section class="course-index">
  %endif
      <div class="sub_tit">
        %if course:
          <a class="view_normal" href="${reverse('people',args=[course.id])}">Search</a>
        %else:
          <a class="view_normal" href="${reverse('people')}">Search</a>
        %endif
        <a class="view_active" href="#">View My Network</a> <span class="line_blue"></span> 
      </div>
      <div class="filter">Search by</div>
      %if course:
      <form method="" id="search_form" action="${reverse('my_people',args=[course_id])}">
      %else:
      <form method="" id="search_form" action="${reverse('my_people')}">
      %endif
      <div class="filters">
        <input type="" name="username" placeholder="User Name" style="width:233px;margin:20px 20px 0" class="filters"/>
      </div>
      <div class="filters">
        <input type="" name="first_name" placeholder="First Name" value="" style="width:233px;margin:20px 20px 0" class="filters"/>
      </div>
      <div class="filters">
        <input type="" name="last_name" placeholder="Last Name" value="" style="width:233px;margin:20px 20px 0" class="filters"/>
      </div>
      <div class="filters">
        <select name="course_id">
          <option value="">Courses</option>
          %for item in courses:
          <option value="${item.id}">${item.display_name}</option>
          %endfor
        </select>
      </div>
      <div class="filters">
        <select name="district_id">
          <option value="">District</option>
          %for item in District.objects.all().order_by('name'):
          <option value="${item.id}">${item.name}</option>
          %endfor            
        </select>
      </div>
      <div class="filters">
        <select  name="school_id">
          <option value="">School</option>
          %if request.GET.get("district_id"):
          %for item in School.objects.filter(district_id=request.GET.get("district_id")).order_by("name"):
          <option value="${item.id}">${item.name}</option>
          %endfor
          %endif           
        </select>
      </div>
      <div class="filters">
        <select name="subject_area_id">
          <option value="">Major Subject Area</option>
          %for item in SubjectArea.objects.all():
          <option value="${item.id}">${item.name}</option>
          %endfor
        </select>
      </div>
      <div class="filters">
        <select name="grade_level_id">
          <option value="">Grade Level</option>
          %for item in GradeLevel.objects.all():
          <option value="${item.id}">${item.name}</option>
          %endfor
        </select>
      </div>
      <div class="filters">
        <select name="years_in_education_id">
          <option value="">Years in Education</option>
          %for item in YearsInEducation.objects.all():
          <option value="${item.id}">${item.name}</option>
          %endfor
        </select>
      </div>
      <div class="filters">
        <select name="percent_lunch">
          <option value="">Free/Reduced Lunch</option>
          %for item in Enum.objects.filter(name="percent_lunch").order_by("odr"):
          <option value="${item.value}">${item.content}</option>
          %endfor
        </select>
      </div>
      <div class="filters">
        <select name="percent_iep">
          <option value="">IEPs</option>
          %for item in Enum.objects.filter(name="percent_iep").order_by("odr"):
          <option value="${item.value}">${item.content}</option>
          %endfor
        </select>
      </div>
      <div class="filters">
        <select name="percent_eng_learner">
          <option value="">English Learners</option>
          %for item in Enum.objects.filter(name="percent_eng_learner").order_by("odr"):
          <option value="${item.value}">${item.content}</option>
          %endfor
        </select>
      </div>
      <input type="hidden" name="prepage" value="${prepage}"/>
      <input type="hidden" name="searching" value="1"/>
      <input type="submit" style="display:none"/>
       <div style="float:left;width:240px;height:28px;font-style:italic;font-weight:bold;padding-top:15px;padding-left:25px;font-size:16px;line-height:20px;">
        *Leave fields blank to search for all people
       </div>
       <div class="but_search" style="line-height:19px;">
         <a href="#" onclick="$('#search_form').submit()"
            class="button_default button-ondark button-icon button-add icon icon-search"
            style="-webkit-user-select: none; text-align:left;width:207px;height:19px;">
           <div style="display:inline-block;text-align:center;width:140px;padding-right:25px;">Search</div>
         </a>
       </div>
       <div class="but_search">
         %if course:
         <a href="${reverse('my_people',args=[course_id])}"
         %else:
         <a href="${reverse('my_people')}"
         %endif
            class="button_default button-ondark button-icon button-add icon icon-clear"
            style="-webkit-user-select: none; text-align:left;width:207px;height:19px;">
           <div style="display:inline-block;text-align:center;width:140px;padding-right:25px;">Clear Search</div>
         </a>
       </div>
    </section>
    <script type="text/javascript">
       var form=$("#search_form");
       form.find("input[name=username]").val("${request.GET.get('username','')}")
       form.find("input[name=first_name]").val("${request.GET.get('first_name','')}")
       form.find("input[name=last_name]").val("${request.GET.get('last_name','')}")
       form.find("select[name=course_id]").val("${search_course_id}")
       form.find("select[name=district_id]").val("${request.GET.get('district_id','')}")
       form.find("select[name=school_id]").val("${request.GET.get('school_id','')}")
       form.find("select[name=subject_area_id]").val("${request.GET.get('subject_area_id','')}")
       form.find("select[name=grade_level_id]").val("${request.GET.get('grade_level_id','')}")
       form.find("select[name=years_in_education_id]").val("${request.GET.get('years_in_education_id','')}")
       form.find("select[name=percent_lunch]").val("${request.GET.get('percent_lunch','')}")
       form.find("select[name=percent_iep]").val("${request.GET.get('percent_iep','')}")
       form.find("select[name=percent_eng_learner]").val("${request.GET.get('percent_eng_learner','')}")       
    </script>
    </form>
    %if course:
      <section>
    %else:
      <section class="course-content">
    %endif
      %if len(people)==0:
      <div style="color:rgb(52, 97, 173);font-size:25px;margin:200px 50px;line-height:35px;text-align:center;">
        We are sorry, it appears there are no results for this search. <br>Please expand your search criteria and try again.
      </div>
      %else:
      <div class="people_tit">People</div>
      %endif
      %for p in people:
      <%
         the_people_id=p.people.id
         profile=UserProfile.objects.get(user_id=p.people.id)
      %>
      <div class="people_content">
        <span class="head_photo" style="background:transparent;">
          <a href="${reverse('dashboard',args=[profile.user_id])}" target="_blank">
            <img src="${reverse('user_photo',args=[profile.user.id])}" style="" alt="photo" />
          </a>
        </span>
        <span class="name_container2">
          <span class="full_name">
            <a href="${reverse('dashboard',args=[profile.user_id])}" style="color:rgb(52, 97, 173)" target="_blank">${profile.user.first_name} ${profile.user.last_name}</a>
          </span> 
          <span class="name_text">${profile.user.username}</span>
          %if profile.cohort_id and profile.school_id:
          <span class="name_text">${profile.school.name} <br/> ${profile.cohort.district.name}</span>
          %endif
          %if type(profile.years_in_education_id)==int and profile.years_in_education_id > 0:
          <span class="name_text">${profile.years_in_education.name} Years in Education</span>
          %endif
          %if 0:
          <span class="name_text" style="color:#FFC90E;font-weight:bold;">Online Now!</span>              
          %endif
          </span>
        </span>
		<div class="btn_container">
          <a href="#" class="button_default button-ondark button-icon button-yellow icon icon-search" style="-webkit-user-select: none; ">&nbsp;&nbsp;&nbsp;In My Network&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
          <a class="button-del" style="cursor:pointer;" onclick="remove_people('${p.id}');return false;"></a>
          <div style="padding-top:10px;width:158px;text-align:center;">
            <img src="/static/images/imessage.jpg" width="50" />
          </div>
        </div>
      </div>
      %endfor
    %if len(people)>0:
    %if course:
    <div class="page" style="width:850px;" >
      <span style="float:left;">Total Search Results: ${pager.count}</span>
      <span style="float:right;">
        Items Per Page
        <select id="text_pre_page" autocomplate="off">
          <option>25</option>
          <option>50</option>
          <option>100</option>
          <option>200</option>
        </select>
        <a href="${reverse('my_people',args=[course_id])}?${params}&page=${pager.page_num-1}" class="up_page"></a>
        %for p in pager.page_range_ext:
        %if p==pager.page_num:
        <a href="${reverse('my_people',args=[course_id])}?${params}&page=${p}" class="page_active">${p}</a>
        %else:
        <a href="${reverse('my_people',args=[course_id])}?${params}&page=${p}">${p}</a>
        %endif
        %endfor
        <a href="${reverse('my_people',args=[course_id])}?${params}&page=${pager.page_num+1}" class="next_page"></a>
      </span>
    </div>
    %else:
    <div class="page" style="width:850px;" >
      <span style="float:left;">Total Search Results: ${pager.count}</span>
      <span style="float:right;">
      Items Per Page
      <select id="text_pre_page" autocomplate="off">
          <option>25</option>
          <option>50</option>
          <option>100</option>
          <option>200</option>
        </select>
      <a href="${reverse('my_people')}?${params}&page=${pager.page_num-1}" class="up_page"></a>
      %for p in pager.page_range_ext:
      %if p==pager.page_num:
      <a href="${reverse('my_people')}?${params}&page=${p}" class="page_active">${p}</a>
      %else:
      <a href="${reverse('my_people')}?${params}&page=${p}">${p}</a>
      %endif
      %endfor
      <a href="${reverse('my_people')}?${params}&page=${pager.page_num+1}" class="next_page"></a>
      </span>
    </div>
    %endif
    %endif
        </div>
    </section>
  </div>
</section>
<div style="height:20px; width:100%; clear:both;"></div>
<script type="text/javascript">
$("#text_pre_page").val("${prepage}")
$("#text_pre_page").bind('change', function(e){
      var f=$("#search_form");
      f.find("input[name=prepage]").val($(this).val());
      f.submit();
});
function remove_people(id){
  if(confirm("Are you sure that you would like to remove this person from your network list?")){
    $.post("${reverse('remove_people')}",{id:id},function(r){
      if ((typeof r) == 'string') r=$.parseJSON();
      if(r.success)
        window.location.reload();
    });
  }
}
var form=$("#search_form");
form.find("select[name=district_id]").change(function(){
  var district_id=$(this).val();
  if(district_id){
    dropSchool(form,'',district_id);
  }else{
    var drop=form.find("select[name=school_id]")
    clearOption(drop)
  }
})
</script>
