<%! from django.utils.translation import ugettext as _ %>

<%inherit file="main.html" />

<%namespace name='static' file='static_content.html'/>
<%namespace file='main.html' import="login_query"/>

<%!
from django.core.urlresolvers import reverse 
from django.utils import html 
from django_countries.countries import COUNTRIES 
from django.utils.translation import ugettext as _ 
from student.models import UserProfile 
from datetime import date 
import calendar 
from libtahoe import isdev,isdemo1,isdemo2 
from student.models import State,District,SubjectArea,GradeLevel,YearsInEducation,School
from baseinfo.models import Enum
import json
%>

<!--@begin:Add page style-->
<!--@date:2013-11-02-->
<script type="text/javascript" src="/static/js/admin_ui_controls.js"></script>
<link rel="stylesheet" href="/static/css/admin_ui_controls.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="/static/css/vendor/ui-lightness/jquery-ui-1.8.22.custom.css" media="screen"/>
<link rel="stylesheet" type="text/css"  href="/static/tmp-resource/css/ppd-general01.css"/>
<link rel="stylesheet" href="/static/css/amazeui.cropper.css">
<link rel="stylesheet" href="/static/css/custom_up_img.css">
<script src="/static/js/amazeui.min.js" charset="utf-8"></script>
<script src="/static/js/cropper.min.js" charset="utf-8"></script>
<script src="/static/js/custom_up_img3.js" charset="utf-8"></script>
<style>
  #submit:hover {
  background:#6e8194;
  transition-delay: 0s, 0s, 0s;
  transition-duration: 0.25s, 0.25s, 0.25s;
  transition-property:color, background,​ box-shadow;
  transition-timing-function:cubic-bezier(0.42, 0, 0.58, 1), cubic-bezier(0.42, 0, 0.58, 1), cubic-bezier(0.42, 0, 0.58, 1);
  transition-duration:0.25s,​ 0.25s,​ 0.25s;
  color:#fff;
  }
  #submit {
  background-color:#556370;
  text-decoration: none;
  padding-bottom: 7px;
  padding-left: 10px;
  padding-right: 10px;
  padding-top: 7px;
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  cursor: pointer;
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
  font-family: 'Open Sans',Verdana,Geneva,sans-serif;
  box-shadow: #949494 0px 2px 1px 0px;
  color:#fff;
  transition-timing-function:cubic-bezier(0.42, 0, 0.58, 1), cubic-bezier(0.42, 0, 0.58, 1), cubic-bezier(0.42, 0, 0.58, 1);
  }
  #submit:normal {
  background-color:#126F9A;
  text-decoration: none;
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  cursor: pointer;
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
  font-family: 'Open Sans',Verdana,Geneva,sans-serif;
  box-shadow: rgb(10, 74, 103) 0px 2px 1px 0px;
  color:#fff;
  transition-timing-function:cubic-bezier(0.42, 0, 0.58, 1), cubic-bezier(0.42, 0, 0.58, 1), cubic-bezier(0.42, 0, 0.58, 1);
  }
  
  .lean-overlay .loading {width: 128px; height: 128px; display: block; border-radius: 100px; position: absolute; left: 50%; top: 300px; margin-left: -64px;}	
  .org_description{ font-size:12px; color:#646464}
  .org_name_no_required::after{content:'' !important;}
  .org_assignment_qualifications_datex{width:200px !important;}
  .list-input .field input[type="checkbox"]{display:inline-block !important; width:30px !important;}
  .list-input .field input[type="radio"]{display:inline-block !important; width:30px !important;}
  .my_label {font-weight:normal !important;}
  .my_label:after {margin-left: 0 !important; content: "" !important;}
</style>
<!--@end-->
<%block name="title"><title>${_("Register for {platform_name}").format(platform_name=settings.PLATFORM_NAME)}</title></%block>
<%block name="js_extra">
  <script type="text/javascript">	
  	var OrganizationId = "";
    $(function() {
      var view_name = 'view-register';
      // adding js class for styling with accessibility in mind
      $('body').addClass('js').addClass(view_name);
      // new window/tab opening
      $('a[rel="external"], a[class="new-vp"]')
      .click( function() {
      window.open( $(this).attr('href') );
      return false;
      });
      // form field label styling on focus
      $("form :input").focus(function() {
        $("label[for='" + this.id + "']").parent().addClass("is-focused");
      }).blur(function() {
        $("label").parent().removeClass("is-focused");
      });
    });
    (function() {
      toggleSubmitButton(true);
      $('#register-form').on('submit', function() {
        toggleSubmitButton(false);
										
		//----------------Major Subject Area
		if(!$("select[name='major_subject_area_id']").is(":hidden")){
			if($("select[name='major_subject_area_id']").val() == ""){
				toggleSubmitButton(true);
				var tmp_name = $("#organization_info_org_default_1").find(".org_name").html().replace(" *", "");
			 	$('.status.message.submission-error').addClass('is-shown').focus();
			 	$('.status.message.submission-error .message-copy').html(tmp_name + " is required").stop().css("display", "block");
				$(".field-error").removeClass('field-error');
				$("select[name='major_subject_area_id']").addClass('field-error');			 	
				return false;	
			}
		}
		//----------------Grade Level-Check all that apply
		if(!$(".btn_grade_level").is(":hidden")){
			if($("#grade_level_id").val() == ""){
				toggleSubmitButton(true);
				var tmp_name = $("#organization_info_org_default_2").find(".org_name").html().replace(" *", "");
			 	$('.status.message.submission-error').addClass('is-shown').focus();
			 	$('.status.message.submission-error .message-copy').html(tmp_name + " is required").stop().css("display", "block");
				$(".field-error").removeClass('field-error');
				$("#grade_level_id").addClass('field-error');			 	
				return false;	
			}
		}
		//----------------Number of Years in Education
		if(!$("select[name='years_in_education_id']").is(":hidden")){
			if($("select[name='years_in_education_id']").val() == ""){
				toggleSubmitButton(true);
				var tmp_name = $("#organization_info_org_default_3").find(".org_name").html().replace(" *", "");
			 	$('.status.message.submission-error').addClass('is-shown').focus();
			 	$('.status.message.submission-error .message-copy').html(tmp_name + " is required").stop().css("display", "block");
				$(".field-error").removeClass('field-error');
				$("select[name='years_in_education_id']").addClass('field-error');			 	
				return false;	
			}
		}
		//----------------My Learners' Profile
		if(!$("select[name='percent_lunch']").is(":hidden")){
			if($("select[name='percent_lunch']").val() == ""){
				toggleSubmitButton(true);
			 	$('.status.message.submission-error').addClass('is-shown').focus();
			 	$('.status.message.submission-error .message-copy').html("Free/Reduced Lunch is required").stop().css("display", "block");
				$(".field-error").removeClass('field-error');
				$("select[name='percent_lunch']").addClass('field-error');			 	
				return false;	
			}
		}else{
			$("select[name='percent_lunch']").find("option").eq(1).prop("selected",true)
		}
		if(!$("select[name='percent_iep']").is(":hidden")){
			if($("select[name='percent_iep']").val() == ""){
				toggleSubmitButton(true);
			 	$('.status.message.submission-error').addClass('is-shown').focus();
			 	$('.status.message.submission-error .message-copy').html("IEPs is required").stop().css("display", "block");
				$(".field-error").removeClass('field-error');
				$("select[name='percent_iep']").addClass('field-error');			 	
				return false;	
			}
		}else{
			$("select[name='percent_iep']").find("option").eq(1).prop("selected",true)
		}
		if(!$("select[name='percent_eng_learner']").is(":hidden")){
			if($("select[name='percent_eng_learner']").val() == ""){
				toggleSubmitButton(true);
			 	$('.status.message.submission-error').addClass('is-shown').focus();
			 	$('.status.message.submission-error .message-copy').html("English Learners is required").stop().css("display", "block");
				$(".field-error").removeClass('field-error');
				$("select[name='percent_eng_learner']").addClass('field-error');			 	
				return false;	
			}
		}else{
			$("select[name='percent_eng_learner']").find("option").eq(1).prop("selected",true)
		}
		//-----------------	
		var org_content = '"email":"${profile.user.email}"';
		var is_pass = true;
		$(".org_field").each(function(){
			var tmp_type = $(this).attr("field_type");
			var tmp_required = $(this).attr("isRequired");
			var tmp_name = $(this).attr("name");
			var tmp_val = "";
			
			if(tmp_type == "2"){
				tmp_val = $(this).val();
				
			}else if(tmp_type == "3"){
				tmp_val = $(this).val();
				
			}else if(tmp_type == "4"){
				$(this).find('input[type="checkbox"]').each(function() {
					if ($(this).attr('checked')) {
						if(tmp_val != "")	tmp_val += ",";
						tmp_val += $(this).val();
					}
				});
			}else if(tmp_type == "5"){
				tmp_val = $(this).find("input[type='radio']:checked").val();
				
			}else if(tmp_type == "6"){
				tmp_val = escape($(this).val());
				
			}else if(tmp_type == "7"){
				tmp_val = escape($(this).val());
				
			}else if(tmp_type == "8"){
				var tmp_date = $(this).datepicker("getDate");
				var tmp_var1 = "";
				if(tmp_date){
					tmp_var1 = tmp_date.getMonth() + 1;
					tmp_val = (tmp_var1 < 10) ? "0" + tmp_var1 : String(tmp_var1);
					tmp_val += "/";
					tmp_var1 = tmp_date.getDate();
					tmp_val += (tmp_var1 < 10) ? "0" + tmp_var1 : String(tmp_var1);
					tmp_val += "/" + tmp_date.getFullYear();	//mm/dd/yy 
				}
			}
			
			if(tmp_required == " *" && tmp_val == ""){
				toggleSubmitButton(true);
				$('.status.message.submission-error').addClass('is-shown').focus();
				$('.status.message.submission-error .message-copy').html(tmp_name + " is required").stop().css("display", "block");
				$(".field-error").removeClass('field-error');
				$("*[name='" + tmp_name + "']").addClass('field-error');
				is_pass = false;
				return false;	
			}else{
				org_content += ',"' + tmp_name + '":"' + tmp_val + '"';
			}
		});
		if(!is_pass) {
			return false;
		}else{
			$.ajaxSettings.async = false; 
			$.post("${reverse('organizational_configuration')}", {flag: "organization_register_save", email:"${profile.user.email}", OrganizationId: OrganizationId, content: "{" + org_content + "}"}, function (r) {
				if (r.Success){
				}else{
					toggleSubmitButton(true);
					return false;	
				}
			});
			$.ajaxSettings.async = true;
		}
      });
	  
      $('#register-form').on('ajax:error', function() {
        toggleSubmitButton(true);
      });
	  
      $('#register-form').on('ajax:success', function(event, json, xhr) {
       if(json.success) {
           var urlParams = {};
           var searchString = window.location.search.substring(1);
           if (searchString !== undefined) {
               var pairs = searchString.split('&');
               for (var i = 0; i < pairs.length; i++) {
                   var values = pairs[i].split('=');
                   urlParams[values[0]] = values[1] === undefined ? false : decodeURIComponent(values[1]);
               }
           }
           if (urlParams['next'] !== undefined && !isExternal(urlParams['next']) && urlParams['next'].match(/^course.+courseware/)) {
               var next = urlParams['next'];
               if (next.substring(0,1) != '/') {
                   next = '/' + next;
               }
               location.href = next;
           }  else {
               location.href = "${reverse('dashboard')}";
           }
       } else {
         toggleSubmitButton(true);
         $('.status.message.submission-error').addClass('is-shown').focus();
         $('.status.message.submission-error .message-copy').html(json.value || json.error ).stop().css("display", "block");
         if(json.field){
              $(".field-error").removeClass('field-error');
              $("[data-field='"+json.field+"']").addClass('field-error')
         }
       }
      });
    })(this);
    function toggleSubmitButton(enable) {
      var $submitButton = $('form .form-actions #submit');
      if(enable) {
/*@begin:Change the button text in login page*/
/*@date:2013-11-02*/
        $submitButton.
          removeClass('is-disabled').
          removeProp('disabled').
          html("${_('Create My {platform_name} Account').format(platform_name=settings.PLATFORM_NAME)}");
/*@end*/        
      }
      else {
        $submitButton.
          addClass('is-disabled').
          prop('disabled', true).
          html(gettext('Processing your account information &hellip;'));
      }
    }
  </script>
</%block>

  <script type="text/javascript">
    var json_school="[]";
    function reload_school_dropdown(district_id){
      var drop=document.getElementById("school_id");
      $(drop).find("option").filter(function(){return $.trim(this.value)!=''}).remove();
      if(district_id=='') return;
      $.each(json_school,function(i,school){
        if(school.district_id==district_id)
          $(drop).append("<option value='"+school.id+"'>"+school.name+"</option>");
      });
    }
    function click_grade_btn(i){
      var vals={};
      $.each($("#grade_level_id").val().split(","),function(i,v){
        if(v)vals[v]=1;
      });
      var link=document.getElementById("grade_btn"+i);
      if($(link).hasClass("btn_grade_level_active")){
        $(link).removeClass("btn_grade_level_active");
        vals[i]='';
      }else{
        $(link).addClass("btn_grade_level_active");
        vals[i]=1;
      }
      var arVals=[];
      $.each(vals,function(i,v){
        if(v)arVals.push(i);
      });
      arVals.sort(function(a,b){
        return parseInt(a)-parseInt(b);
      });
      $("#grade_level_id").val(arVals.join());
    }
  </script>

<!--@begin:Change the banding image in Login page-->
<!--@date:2013-11-02-->
<div style="margin:0 auto;width:960px;height:195px;background:url(/static/images/ppd-register-banner.png);border-bottom:1px solid #000;">
	<div class="_banner_whatis_title_font">
		WELCOME
		<div class="_banner_whatis_title_content_font">
			register below to create your account
		</div>
	</div>
</div>
<!--@end-->
<div style="width:960px;margin:0 auto;">
<section class="register container">
  <section role="main" class="content">
    <form role="form" id="register-form" method="post" data-remote="true" action="/create_account" novalidate>
      <!-- status messages -->
      <input id="activation_key" type="hidden" name="activation_key" value="${activation_key}" required aria-required="true" />
      
      <div role="alert" class="status message">
        <h3 class="message-title">${_("We're sorry, {platform_name} enrollment is not available in your region").format(platform_name=settings.PLATFORM_NAME)}</h3>
        <p class="message-copy">Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</p>
      </div>
      <div role="alert" class="status message submission-error" tabindex="-1">
        <h3 class="message-title">${_("The following errors occured while processing your registration:")} </h3>
        <ul class="message-copy"> </ul>
      </div>
      <p class="instructions">
        ${_("Please complete the following fields to register for an account. ")}<br />
        ${_('Required fields are noted by <strong class="indicator">bold text and an asterisk (*)</strong>.')}
      </p>
      <fieldset class="group group-form group-form-requiredinformation">
        <legend class="sr">${_('Required Information')}</legend>
        % if has_extauth_info is UNDEFINED:
        <ol class="list-input" id="org_list_list">
          <li class="field text" id="field-email">
<!--@begin:Registraction page: remove some asterisks and change the font to bold-->
<!--@date:2013-11-02-->
            <label for="email" style="font-weight:bold;">${_('E-mail')}</label>
            %if profile:
            <input type="hidden" name="email" value="${profile.user.email}" />
            ${profile.user.email}
            %else:
            <input class="" id="email" type="email" name="email" value="" placeholder="${_('example: username@domain.com')}" required aria-required="true" />
            %endif
<!--@end-->
          </li>
          <li class="field required password" id="field-password">
            <label for="password">${_('Password')}</label>
            <input id="password" type="password" name="password" value="" required aria-required="true" />
            <span class="tip tip-input">${_('<b>Cannot</b> be the same as Public Username below.')}</span>
          </li>
          <li class="field required text" id="field-username">
            <label for="username">${_('Public Username')}</label>
            <input id="username" type="text" name="username" value="" placeholder="${_('example: JaneDoe')}" required aria-required="true" maxlength="30"/>
            <span class="tip tip-input">${_('<b>Cannot</b> be the same as Password. Will be shown in any discussions or forums you participate in.')}</span>
          </li>

<!--@begin:Registraction page: add more fields-->
<!--@date:2013-11-02-->
          <li class="field required text" id="field-name">
            <label for="first_name">${_('First Name')}</label>
            <input id="first_name" type="text" name="first_name" value="" placeholder="${_('example: Jane')}" required aria-required="true" maxlength="30"/>
            <span class="tip tip-input">${_("Needed for any certificates you may earn")}</span>
          </li>
          <li class="field required text" id="field-name">
            <label for="last_name">${_('Last Name')}</label>
            <input id="last_name" type="text" name="last_name" value="" placeholder="${_('example: Doe')}" required aria-required="true" maxlength="30"/>
            <span class="tip tip-input">${_("Needed for any certificates you may earn")}</span>
          </li>
          
          <li class="field required text" id="field-name">
            <label for="school_id">${_('State')}</label>
            <span id="organization_info_state">${profile.district.state.name}</span>
          </li>

          <li class="field required text" id="field-name">
            <label for="school_id">${_('District')}</label>
            <input type="hidden" name="district_id" value="${profile.district.id}" />
            <span id="organization_info_district">${profile.district.name}</span>
          </li>
          
          <li class="field required text" id="field-name">
            <label for="school_id">${_('School')}</label>
            <select autocomplete="off" id="school_id" name="school_id">
              <option value="">--</option>
              %for item in School.objects.filter(district_id=profile.district_id).order_by("name"):
              <option value="${item.id}">${item.name}</option>
              %endfor
            </select>
          </li>
          <li class="field required text" id="field-name">
              <span id="organization_info_org_default_1">
                <label class="org_name org_name_no_required" for="major_subject_area_id">${_('Major Subject Area')}</label>
                <select autocomplete="off" name="major_subject_area_id">
                  <option value="">--</option>
                  %for item in SubjectArea.objects.all().order_by("so"):
                  <option value="${item.id}">${item.name}</option>
                  %endfor
                </select>
                <br><span class="org_description"></span>
              </span>
          </li>
          <link rel="stylesheet" href="/static/tmp-resource/css/main.css" type="text/css" media="screen" />
          <li class="field required text" id="field-name">
              <span id="organization_info_org_default_2">
                <label class="org_name org_name_no_required" for="grade_level_id">${_('Grade Level-Check all that apply')}</label>
                <div class="level_containter" style="margin-bottom:10px;">
                <input type="hidden" autocomplete="off" id="grade_level_id" name="grade_level_id" value="" />
                  %for item in GradeLevel.objects.all():
                  <span class="level">
                    <a href="#" id="grade_btn${item.id}" class="btn_grade_level" onclick="click_grade_btn(${item.id});return false">
                      ${item.name}
                    </a>
                  </span>
                  %endfor
                  </div>
                  <br><span class="org_description"></span>
              </span> 
         </li>          
         <li class="field required text" id="field-name">
             <span id="organization_info_org_default_3">
                <label class="org_name org_name_no_required" for="years_in_education_id">${_('Number of Years in Education')}</label>
                <select autocomplete="off" name="years_in_education_id" style="width:100px;">
                  <option value="">--</option>
                  %for item in YearsInEducation.objects.all():
                  <option value="${item.id}">${item.name}</option>
                  %endfor                
                </select>
                <br><span class="org_description"></span>
			  </span>
          </li>
          <span id="organization_info_org_default_456">       
              <div style="padding:10px 0 15px 0;"> 
                <b style="font-size:15px;color:#333;">My Learners' Profile</b>
              </div>
              <li id="organization_info_org_default_4" class="field required text" id="field-name">
                In my class,
                <select autocomplete="off" name="percent_lunch" style="width:100px;">
                  <option value="">--</option>
                  %for item in Enum.objects.filter(name="percent_lunch").order_by("odr"):
                  <option value="${item.value}">${item.content}</option>
                  %endfor                
                </select>
                of my students are eligible for Free/Reduced lunch. <b></b>                
              	<div class="org_description"></div>
              </li>
              <li id="organization_info_org_default_5" class="field required text" id="field-name">
                In my class, 
                <select autocomplete="off" name="percent_iep" style="width:100px;">
                  <option value="">--</option>
                  %for item in Enum.objects.filter(name="percent_iep").order_by("odr"):
                  <option value="${item.value}">${item.content}</option>
                  %endfor 
                </select>
                of my students have an IEP.  <b></b>             
              	<div class="org_description"></div>
              </li>
              <li id="organization_info_org_default_6" class="field required text" id="field-name">
                <select autocomplete="off" name="percent_eng_learner" style="width:100px;">
                  <option value="">--</option>
                  %for item in Enum.objects.filter(name="percent_eng_learner").order_by("odr"):
                  <option value="${item.value}">${item.content}</option>
                  %endfor 
                </select>
                of my students are English Learners. <b></b>             
              	<div class="org_description"></div> 
              </li>
          </span>
          <span id="organization_info_org_default_7">
              <div style="padding:10px 0 15px 0;"> 
              	
                <b class="org_name" style="font-size:15px;color:#333;">About me</b>
              </div>
              <li class="field required text" id="field-name">
                  Please upload a photo to use with your profile.
                  <div style='margin-top: 15px;'>
                      <img src='/static/images/photos/photo_temp.png' id='show_photo' style='border:1px solid black;width:55px;height:55px;border-radius:55px;'>
                      <a id="change_photo_button"> Click Here to Edit Photo</a>
                      <input type='hidden' name='photo' id='user_photo'>
                  </div>
              </li>
              <li class="field required text" id="field-name" style="margin-bottom:20px;">
                Add a bio to your user profile (255 characters max, <span></span> remain) 
                <textarea maxlength="255" name="bio" id="txBio" rows="" cols="" tabindex=""></textarea>
                <script type="text/javascript">
                  var txBio=document.getElementById('txBio');
                  txBio.oninput=function(){
                    $(this).prev("span").html(255-this.value.length)
                  }
                  txBio.oninput()
                </script>
              </li>
              <div class="org_description"></div>
          </span>
        </ol>
        % else:
        <div class="message">
          <h3 class="message-title">${_("Welcome {username}").format(username=extauth_id)}</h3>
          <p class="message-copy">${_("Enter a public username:")}</p>
        </div>
        <ol class="list-input">
          % if ask_for_email:
          <li class="field required text" id="field-email">
            <label for="email">${_("E-mail")}</label>
            <input class="" id="email" type="email" name="email" value="" placeholder="${_('example: username@domain.com')}" />
          </li>
          % endif
          <li class="field required text" id="field-username">
            <label for="username">${_('Public Username')}</label>
            <input id="username" type="text" name="username" value="${extauth_username}" placeholder="${_('example: JaneDoe')}" required aria-required="true" />
            <span class="tip tip-input">${_('Will be shown in any discussions or forums you participate in')}</span>
          </li>
          % if ask_for_fullname:
          <li class="field required text" id="field-name">
            <label for="name">${_('Full Name')}</label>
            <input id="name" type="text" name="name" value="" placeholder="$_('example: Jane Doe')}" />
            <span class="tip tip-input">${_("Needed for any certificates you may earn <strong>(cannot be changed later)</strong>")}</span>
          </li>
          % endif
        </ol>
        % endif
      </fieldset>
      % if False:
      <fieldset class="group group-form group-form-secondary group-form-personalinformation">
        <legend class="sr">${_("Optional Personal Information")}</legend>
        <ol class="list-input">
          <li class="field-group">
            <div class="field select" id="field-education-level">
              <label for="education-level">${_("Highest Level of Education Completed")}</label>
              <select id="education-level" name="level_of_education">
                <option value="">--</option>
                %for code, ed_level in UserProfile.LEVEL_OF_EDUCATION_CHOICES:
                <option value="${code}">${ed_level}</option>
                %endfor
              </select>
            </div>
            <div class="field select" id="field-gender">
              <label for="gender">${_("Gender")}</label>
              <select id="gender" name="gender">
                <option value="">--</option>
                %for code, gender in UserProfile.GENDER_CHOICES:
                <option value="${code}">${gender}</option>
                %endfor
              </select>
            </div>
            <div class="field select" id="field-yob">
              <label for="yob">${_("Year of Birth")}</label>
              <select id="yob" name="year_of_birth">
                <option value="">--</option>
                %for year in UserProfile.VALID_YEARS:
                <option value="${year}">${year}</option>
                %endfor
              </select>
            </div>
          </li>
        </ol>
      </fieldset>
      <fieldset class="group group-form group-form-personalinformation2">
        <legend class="sr">${_("Optional Personal Information")}</legend>
        <ol class="list-input">
          <li class="field text" id="field-address-mailing">
            <label for="address-mailing">${_("Mailing Address")}</label>
            <textarea id="address-mailing" name="mailing_address" value=""></textarea>
          </li>
          <li class="field text" id="field-goals">
            <label for="goals">${_("Please share with us your reasons for registering with {platform_name}").format(platform_name=settings.PLATFORM_NAME)}</label>
            <textarea id="goals" name="goals" value=""></textarea>
          </li>
        </ol>
      </fieldset>
      % endif
      <fieldset class="group group-form group-form-accountacknowledgements">
        <legend class="sr">${_("Account Acknowledgements")}</legend>
        <ol class="list-input">
          <li class="field-group">
            
            % if has_extauth_info is UNDEFINED or ask_for_tos :
            <div class="field required checkbox" id="field-tos" style="padding:20px 0">
              <input id="tos-yes" type="checkbox" name="terms_of_service" value="true" required aria-required="true" />
              <label for="tos-yes">${_('I agree to the {link_start}Terms of Service{link_end}').format(
                link_start='<a href="{url}" class="new-vp">'.format(url=marketing_link('TOS')),
                link_end='</a>')}</label>
            </div>
            % endif
            
            % if False:
            <div class="field required checkbox" id="field-honorcode">
              <input id="honorcode-yes" type="checkbox" name="honor_code" value="true" />
              <%
                ## TODO: provide a better way to override these links
                if self.stanford_theme_enabled():
                  honor_code_path = marketing_link('TOS') + "#honor"
                else:
                  honor_code_path = marketing_link('HONOR')
              %>
              <label for="honorcode-yes">${_('I agree to the {link_start}Honor Code{link_end}').format(
                link_start='<a href="{url}" class="new-vp">'.format(url=honor_code_path),
                link_end='</a>')}</label>
            </div>
            % endif
          </li>
        </ol>
      </fieldset>
% if course_id and enrollment_action:
      <input type="hidden" name="enrollment_action" value="${enrollment_action | h}" />
      <input type="hidden" name="course_id" value="${course_id | h}" />
% endif
      <div class="form-actions">
        <button name="submit" type="submit" id="submit" class="action action-primary action-update">${_('Register')} <span class="orn-plus">+</span> ${_('Create My Account')}</button>
      </div>
    </form>
  </section>
  <aside role="complementary">
    <header>
      <h3 class="sr">${_("Registration Help")}</h3>
    </header>
    % if has_extauth_info is UNDEFINED:
    <div class="cta">
      <h3>${_("Already registered?")}</h3>
      <p class="instructions">
        <a href="${reverse('signin_user')}${login_query()}">
          ${_("Click here to log in.")}
        </a>
      </p>
    </div>
    % endif
    ## TODO: Use a %block tag or something to allow themes to
    ##       override in a more generalizable fashion.
    <div class="cta cta-nextsteps">
      <h3>${_("Next Steps")}</h3>
      % if self.stanford_theme_enabled():
        <p>${_("You will receive an activation email.  You must click on the activation link to complete the process.  Don't see the email?  Check your spam folder and mark emails from class.stanford.edu as 'not spam', since you'll want to be able to receive email from your courses.")}</p>
      % else:
<!--@begin:Change the text on the right side-->
<!--@date:2013-11-02-->
      <p>${_("As part of joining {platform_name}, you will receive a confirmation email.  Don’t see the email? Check your spam folder and mark {platform_name} emails as “not spam.”  At {platform_name}, we communicate mostly through email.").format(platform_name=settings.PLATFORM_NAME)}</p>
<!--@end-->              
      % endif
    </div>
<!--@begin:Remove the default FQA-->
<!--@date:2013-11-02-->
    % if False and settings.MKTG_URL_LINK_MAP.get('FAQ'):
      <div class="cta cta-help">
        <h3>${_("Need Help?")}</h3>
        <p>${_("Need help in registering with {platform_name}?").format(platform_name=settings.PLATFORM_NAME)}
          <a href="${marketing_link('FAQ')}">
              ${_("View our FAQs for answers to commonly asked questions.")}
          </a>
          ${_("Once registered, most questions can be answered in the course specific discussion forums or through the FAQs.")}</p>
      </div>
    % endif
<!--@end-->    
  </aside>
</section>
<div/>
<section id="change_photo" class="modal" style='width:620px;display:none;top:1200px'>
  <div class="inner-wrapper" tabindex="-1" id="doc-modal-1" style='width:600px'>
  <header>
      <h2>${_('Add Profile Picture').format()}</h2>
      <hr/>
    </header>
  <div class="am-modal-dialog up-frame-parent up-frame-radius">
    <div class="am-modal-bd  up-frame-body">
      <div class="am-g am-fl">
        <div class="am-form-group am-form-file">
          <input type="file" id="inputImage">
        </div>
      </div>
      <div class="am-g am-fl" >
        <div class="up-pre-before up-frame-radius">
            <img alt="" src="" id="image" >
        </div>
        <div class="up-pre-after up-frame-radius">
        </div>
      </div>
    </div>
    </div>
        <div class="up-control-btns" style='float:left;margin-left: 20px;'>
            <button class="am-icon-rotate-left" type='button'  onclick="rotateimgleft()">turnleft</button>
            <button class="am-icon-rotate-right" type='button' onclick="rotateimgright()">turnright</button>
            <button class="am-icon-check" id="up-btn-ok" type='button' url="upload.php">confirm</button>
        </div>
    <div class="close-modal" id="change_photo_close">
      <div class="inner">
        <p>&#10005;</p>
      </div>
    </div>
    </div>
</section>
<script>
function LoadingWin(){
	this.$loader = null;
	this.show();
}
LoadingWin.prototype.show = function () {
	if (!this.$loader) {
		this.$loader = $('<div class="lean-overlay"><img class="loading" src="/static/images/loading.gif"></div>');
		this.$loader.appendTo(document.body);
	}
	this.$loader.css('display','block');
};
LoadingWin.prototype.hide = function () {
	if (this.$loader) {
		this.$loader.remove();
		this.$loader = null;
	}
};

$(document).ready(function(){	
  $("#change_photo_button").click(function(){
    $("#change_photo").show();
  })
  $("#change_photo_close").click(function(){
    $("#change_photo").hide();
  })
	//------------------organization_get_info	
	var loadwin = new LoadingWin();		
	$.post("${reverse('organizational_configuration')}", {flag:"organization_get_info", source:"register", state: "${profile.district.state.id}", district: "${profile.district.id}"}, function (r) {
		if (r.SiteURL_OK){
			if(r.Success){
				if(r.OrganizationOK){
					OrganizationId = r.OrganizationId;
          if (r.DistrictType == "") r.DistrictType="District"
          if (r.SchoolType == "") r.SchoolType="School"
					$("#organization_info_district").parent().find("label").html(r.DistrictType);
					$("#school_id").parent().find("label").html(r.SchoolType);
		  			
					if(r.org_rg_data_items != ""){
						var tmp_specific_items = eval("(" + r.org_rg_data_items + ")");
						for(var tmpx in tmp_specific_items){
							var tmp_json = tmp_specific_items[tmpx];
							var tmp_required = (tmp_json["required"] == "1") ? " *" : "";
							
							if(tmp_json["default"] && tmp_json["default"] != ""){
								var find_el = $("#organization_info_org_default_" + tmp_json["default"]);
								if(tmp_json["default_visible"] == "0"){
									find_el.find(".org_description").html(tmp_json["description"]);
									if(tmp_json["default"] == "4" || tmp_json["default"] == "5" || tmp_json["default"] == "6"){
										find_el.find("b").html(tmp_required);
									}else{
										find_el.find(".org_name").html(tmp_json["name"] + tmp_required);
									}
								}else{
									find_el.hide();
								}								
							}else{
								var tmp_content = "";
								if(tmp_json["field_type"] == "1"){
									tmp_content += '<li class="field required text" id="field-name">';
									
									tmp_content += '<label for="' + tmp_json["name"] + '" class="org_name_no_required">' + tmp_json["name"] + tmp_required + '</label>';
									tmp_content += '<span></span>';
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
									
								}else if(tmp_json["field_type"] == "2"){
									var tmp_list1 = tmp_json["field_type_2"].split("|-|-|");
									tmp_content += '<li class="field required text" id="field-name">';
									
									tmp_content += '<label for="' + tmp_json["name"] + '" class="org_name_no_required">' + tmp_json["name"] + tmp_required + '</label>';
									tmp_content += '<select class="org_field" field_type="2" isRequired="' + tmp_required + '" autocomplete="off" name="' + tmp_json["name"] + '" style="width:500px;"><option value="">--</option>';
									for(var ii in tmp_list1){
										var tmp_list2 = tmp_list1[ii].split("|-|");
										tmp_content += '<option value="' + tmp_list2[0] + '">' + tmp_list2[0] + '</option>';
									}
									tmp_content += '</select>';
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
									
								}else if(tmp_json["field_type"] == "3"){
									var tmp_list1 = tmp_json["field_type_3"].split("|-|-|");
									tmp_content += '<li class="field required text" id="field-name">';
									
									tmp_content += '<label for="' + tmp_json["name"] + '" class="org_name_no_required">' + tmp_json["name"] + tmp_required + '</label>';
									tmp_content += '<select class="org_field" field_type="3" isRequired="' + tmp_required + '" autocomplete="off" name="' + tmp_json["name"] + '" style="width:500px;" size="5" multiple="multiple">';
									for(var ii in tmp_list1){
										var tmp_list2 = tmp_list1[ii].split("|-|");
										tmp_content += '<option value="' + tmp_list2[0] + '">' + tmp_list2[0] + '</option>';
									}
									tmp_content += '</select>';
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
									
								}else if(tmp_json["field_type"] == "4"){
									
									tmp_content += '<div style="padding:2px 0 5px 0;"><b style="font-size:15px;color:#333;">' + tmp_json["name"] + tmp_required + '</b></div>';
									tmp_content += '<li class="field required text org_field" id="field-name" field_type="4" name="' + tmp_json["name"] + '" isRequired="' + tmp_required + '">';
									if(tmp_json["field_type_4"] != ""){
										var tmp_list1 = tmp_json["field_type_4"].split("|-|-|");
										for(var ii in tmp_list1){
											var tmp_list2 = tmp_list1[ii].split("|-|");
											tmp_content += '<label class="my_label"><input type="checkbox" name="' + tmp_json["name"] + '" value="' + tmp_list2[0] + '" />' + tmp_list2[0] + '</label>';
										}
									}
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
									
								}else if(tmp_json["field_type"] == "5"){
									
									tmp_content += '<div style="padding:2px 0 5px 0;"><b style="font-size:15px;color:#333;">' + tmp_json["name"] + tmp_required + '</b></div>';
									tmp_content += '<li class="field required text org_field" id="field-name" field_type="5" name="' + tmp_json["name"] + '" isRequired="' + tmp_required + '">';
									if(tmp_json["field_type_5"] != ""){
										var tmp_list1 = tmp_json["field_type_5"].split("|-|-|");
										for(var ii in tmp_list1){
											var tmp_list2 = tmp_list1[ii].split("|-|");
											tmp_content += '<label class="my_label"><input type="radio" ' + ((ii == 0) ? "checked=checked" : "") + ' name="' + tmp_json["name"] + '" value="' + tmp_list2[0] + '" />' + tmp_list2[0] + '</label>';
										}
									}
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
								
								}else if(tmp_json["field_type"] == "6"){
									tmp_content += '<li class="field required text" id="field-name">';
									
									tmp_content += '<label for="' + tmp_json["name"] + '" class="org_name_no_required">' + tmp_json["name"] + tmp_required + '</label>';
									tmp_content += '<input type="text" name="' + tmp_json["name"] + '" value="" required aria-required="true" maxlength="30"  class="org_field" field_type="6" isRequired="' + tmp_required + '"/>';
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
									
								}else if(tmp_json["field_type"] == "7"){
									tmp_content += '<li class="field required text" id="field-name">';
									
									tmp_content += '<label for="' + tmp_json["name"] + '" class="org_name_no_required">' + tmp_json["name"] + tmp_required + '</label>';
									tmp_content += '<textarea maxlength="255" name="' + tmp_json["name"] + '" class="org_field" field_type="7" isRequired="' + tmp_required + '"></textarea>';
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
									
								}else if(tmp_json["field_type"] == "8"){
									tmp_content += '<li class="field required text" id="field-name">';
									
									tmp_content += '<label for="' + tmp_json["name"] + '" class="org_name_no_required">' + tmp_json["name"] + tmp_required + '</label>';
									tmp_content += '<input type="text" class="org_assignment_qualifications_datex org_field" value="" placeholder="Select Date" readonly="true" name="' + tmp_json["name"] + '" field_type="8" isRequired="' + tmp_required + '" />';
                  tmp_content += '<span class="org_description">' + tmp_json["description"] + '</span>';
									tmp_content += '</li>';
								}
								
								if(tmp_content != "")	$("#org_list_list").append(tmp_content);
							}
						}
					}
					if($("#organization_info_org_default_456").find("li:visible").length == 0){
						$("#organization_info_org_default_456").hide();
					}
					$(".org_assignment_qualifications_datex").datepicker();
				}
			}
		}
		loadwin.hide();
	});
});
//--------------------------
$.datepicker.setDefaults({
	showButtonPanel: true, 
	closeText: 'Clear', 
	currentText: 'Today',
	autoSize: true,
	gotoCurrent: true,
	firstDay: 0,
	minDate: new Date("1999-9-9"),
	hideIfNoPrevNext: false,
	navigationAsDateFormat: true,
	showOtherMonths: true,
	selectOtherMonths: false,
	stepMonths: 1,
	changeMonth: true,
	numberOfMonths: [1, 1],
	showCurrentAtPos: 0,
	showAnim: "",
	showWeek: true,
	dateFormat: 'mm/dd/yy',
	beforeShow: function (input, inst) {
		datepicker_CurrentInput = input;
	}
});
$(".ui-datepicker-close").live("click", function () {
	$(datepicker_CurrentInput).val("");
	$(datepicker_CurrentInput).change();
});
</script>

